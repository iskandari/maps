{"version":3,"file":"index.modern.js","sources":["../src/mapbox.js","../src/webgl2-compat.js","../src/regl.js","../src/region/context.js","../src/loading/context.js","../src/loading/loading-updater.js","../src/map.js","../src/region/region-picker/circle-picker/utils.js","../src/region/region-picker/circle-picker/cursor-manager.js","../src/region/region-picker/circle-picker/circle-renderer.js","../src/region/region-picker/circle-picker/index.js","../src/region/region-picker/index.js","../src/use-recenter-region.js","../src/use-controls.js","../src/shaders.js","../src/utils.js","../src/constants.js","../src/tile.js","../src/initialize-store.js","../src/tiles.js","../src/raster.js","../src/line.js","../src/fill.js","../src/use-ruler.js"],"sourcesContent":["import React, {\n  createContext,\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n  useContext,\n} from 'react'\nimport mapboxgl from 'mapbox-gl'\n\nexport const MapboxContext = createContext(null)\n\nexport const useMapbox = () => {\n  return useContext(MapboxContext)\n}\n\nconst Mapbox = ({\n  glyphs,\n  style,\n  viewState, // Accept viewState\n  center,\n  zoom,\n  minZoom,\n  maxZoom,\n  maxBounds,\n  debug,\n  children,\n  mapRef,\n  onMove,\n  onMoveStart,\n  onMoveEnd,\n  onViewStateChange,\n}) => {\n  const map = useRef(null)\n  const [ready, setReady] = useState(false)\n\n  // Refs to store event handler functions for cleanup\n  const onViewStateChangeHandlerRef = useRef(null)\n\n  // Initialize the map instance\n  const initializeMap = useCallback(\n    (node) => {\n      if (node !== null && !map.current) {\n        const mapboxStyle = { version: 8, sources: {}, layers: [] }\n        if (glyphs) {\n          mapboxStyle.glyphs = glyphs\n        }\n\n        if (!viewState) {\n          console.error('viewState is undefined in Mapbox component');\n          return null; // or render a fallback UI\n        }\n\n        const { longitude, latitude, zoom, bearing, pitch } = viewState\n\n        map.current = new mapboxgl.Map({\n          container: node,\n          style: mapboxStyle,\n          center: [longitude, latitude],\n          zoom: zoom,\n          bearing: bearing,\n          pitch: pitch,\n          minZoom: minZoom,\n          maxZoom: maxZoom,\n          maxBounds: maxBounds,\n          dragRotate: false,\n          pitchWithRotate: false,\n          touchZoomRotate: true,\n        })\n\n        // Disable unwanted interactions\n        map.current.touchZoomRotate.disableRotation()\n        map.current.touchPitch.disable()\n\n        // Set debug options\n        map.current.showTileBoundaries = debug\n\n        // Expose the map instance via mapRef\n        if (mapRef) {\n          mapRef.current = map.current\n        }\n\n        // Set up event listeners\n        if (onMove) {\n          map.current.on('move', () => {\n            console.log('inside mapbox', 'moved')\n            onMove();\n          })\n        }\n        if (onMoveStart) {\n          map.current.on('movestart', onMoveStart)\n        }\n        if (onMoveEnd) {\n          map.current.on('moveend', onMoveEnd)\n        }\n        if (onViewStateChange) {\n          const handler = () => {\n            const { lng, lat } = map.current.getCenter()\n            const zoom = map.current.getZoom()\n            const bearing = map.current.getBearing()\n            const pitch = map.current.getPitch()\n            onViewStateChange({\n              longitude: lng,\n              latitude: lat,\n              zoom,\n              bearing,\n              pitch,\n            })\n          }\n          map.current.on('move', handler)\n          onViewStateChangeHandlerRef.current = handler\n        }\n\n        map.current.on('styledata', () => {\n          setReady(true)\n        })\n      }\n    },\n    [\n      glyphs,\n      center,\n      zoom,\n      minZoom,\n      maxZoom,\n      maxBounds,\n      debug,\n      mapRef,\n      onMove,\n      onMoveStart,\n      onMoveEnd,\n      onViewStateChange,\n      viewState, // Add viewState to dependencies\n    ]\n  )\n\n    // Update the map when viewState changes\n    useEffect(() => {\n      if (map.current && viewState) {\n        const { longitude, latitude, zoom, bearing, pitch } = viewState\n        map.current.jumpTo({\n          center: [longitude, latitude],\n          zoom: zoom,\n          bearing: bearing,\n          pitch: pitch,\n        })\n      }\n    }, [viewState])\n    \n  useEffect(() => {\n    return () => {\n      if (map.current) {\n        // Remove event listeners\n        if (onMove) {\n          map.current.off('move', onMove)\n        }\n        if (onMoveStart) {\n          map.current.off('movestart', onMoveStart)\n        }\n        if (onMoveEnd) {\n          map.current.off('moveend', onMoveEnd)\n        }\n        if (onViewStateChange && onViewStateChangeHandlerRef.current) {\n          map.current.off('move', onViewStateChangeHandlerRef.current)\n          onViewStateChangeHandlerRef.current = null\n        }\n\n        // Remove the map instance\n        map.current.remove()\n        map.current = null\n        setReady(false)\n      }\n    }\n  }, [onMove, onMoveStart, onMoveEnd, onViewStateChange])\n\n  // Update debug settings if `debug` prop changes\n  useEffect(() => {\n    if (map.current) {\n      map.current.showTileBoundaries = debug\n    }\n  }, [debug])\n\n  return (\n    <MapboxContext.Provider value={{ map: map.current }}>\n      <div\n        style={{\n          top: '0px',\n          bottom: '0px',\n          position: 'absolute',\n          width: '100%',\n          ...style,\n        }}\n        ref={initializeMap}\n      />\n      {ready && children}\n    </MapboxContext.Provider>\n  )\n}\n\nexport default Mapbox\n","// Compatability layer to make regl work with webgl2.\n// See https://github.com/regl-project/regl/issues/561\nvar GL_DEPTH_COMPONENT = 0x1902\nvar GL_DEPTH_STENCIL = 0x84f9\nvar HALF_FLOAT_OES = 0x8d61\n\n// webgl1 extensions natively supported by webgl2\nvar gl2Extensions = {\n  WEBGL_depth_texture: {\n    UNSIGNED_INT_24_8_WEBGL: 0x84fa,\n  },\n  OES_element_index_uint: {},\n  OES_texture_float: {},\n  // 'OES_texture_float_linear': {},\n  OES_texture_half_float: {\n    HALF_FLOAT_OES: HALF_FLOAT_OES,\n  },\n  // 'OES_texture_half_float_linear': {},\n  EXT_color_buffer_float: {},\n  OES_standard_derivatives: {},\n  EXT_frag_depth: {},\n  EXT_blend_minmax: {\n    MIN_EXT: 0x8007,\n    MAX_EXT: 0x8008,\n  },\n  EXT_shader_texture_lod: {},\n}\n\nvar extensions = {}\nexport const webgl2Compat = {\n  overrideContextType: function (callback) {\n    const webgl2 = this\n    // Monkey-patch context creation to override the context type.\n    const origGetContext = HTMLCanvasElement.prototype.getContext\n    HTMLCanvasElement.prototype.getContext = function (\n      ignoredContextType,\n      contextAttributes\n    ) {\n      return webgl2.wrapGLContext(\n        origGetContext.bind(this)('webgl2', contextAttributes),\n        extensions\n      )\n    }\n    // Execute the callback with overridden context type.\n    var rv = callback()\n\n    // Restore the original method.\n    HTMLCanvasElement.prototype.getContext = origGetContext\n    return rv\n  },\n\n  // webgl1 extensions natively supported by webgl2\n  // this is called when initializing regl context\n  wrapGLContext: function (gl, extensions) {\n    gl[this.versionProperty] = 2\n    for (var p in gl2Extensions) {\n      extensions[p.toLowerCase()] = gl2Extensions[p]\n    }\n\n    // to support float and half-float textures\n    gl.getExtension('EXT_color_buffer_float')\n\n    // Now override getExtension to return ours.\n    const origGetExtension = gl.getExtension\n    gl.getExtension = function (n) {\n      return extensions[n.toLowerCase()] || origGetExtension.apply(gl, [n])\n    }\n\n    // And texImage2D to handle format conversion\n    const origTexImage = gl.texImage2D\n    gl.texImage2D = function (\n      target,\n      miplevel,\n      iformat,\n      a,\n      typeFor6,\n      c,\n      d,\n      typeFor9,\n      f\n    ) {\n      const getInternalFormat =\n        webgl2Compat.getInternalFormat.bind(webgl2Compat)\n      const getFormat = webgl2Compat.getFormat.bind(webgl2Compat)\n      const getTextureType = webgl2Compat.getTextureType.bind(webgl2Compat)\n\n      if (arguments.length == 6) {\n        var ifmt = getInternalFormat(gl, iformat, typeFor6)\n        var fmt = getFormat(gl, iformat)\n        origTexImage.call(\n          gl,\n          target,\n          miplevel,\n          ifmt,\n          a,\n          fmt,\n          getTextureType(gl, typeFor6),\n          c\n        )\n      } else if (arguments.length == 9) {\n        var ifmt = getInternalFormat(gl, iformat, typeFor9)\n        var fmt = getFormat(gl, iformat)\n        var type = getTextureType(gl, typeFor9)\n\n        // Ensure 'f' is an ArrayBufferView\n        if (!(f instanceof ArrayBuffer || ArrayBuffer.isView(f))) {\n          let typedArray\n          switch (type) {\n            case gl.FLOAT:\n              typedArray = new Float32Array(f)\n              break\n            case gl.UNSIGNED_BYTE:\n              typedArray = new Uint8Array(f)\n              break\n            case gl.UNSIGNED_SHORT:\n              typedArray = new Uint16Array(f)\n              break\n            // Add more cases as needed\n            default:\n              throw new Error(`Unsupported type: ${type}`)\n          }\n          f = typedArray\n        }\n\n        // Corrected argument list without the extra 'd'\n        origTexImage.call(\n          gl,\n          target,\n          miplevel,\n          ifmt,\n          a,\n          typeFor6,\n          c,\n          fmt,\n          type,\n          f\n        )\n      } else {\n        throw new Error('Unsupported number of arguments to texImage2D')\n      }\n    }\n\n    // mocks of draw buffers's functions\n    extensions['webgl_draw_buffers'] = {\n      drawBuffersWEBGL: function () {\n        return gl.drawBuffers.apply(gl, arguments)\n      },\n    }\n\n    // mocks of vao extension\n    extensions['oes_vertex_array_object'] = {\n      VERTEX_ARRAY_BINDING_OES: 0x85b5,\n      createVertexArrayOES: function () {\n        return gl.createVertexArray()\n      },\n      deleteVertexArrayOES: function () {\n        return gl.deleteVertexArray.apply(gl, arguments)\n      },\n      isVertexArrayOES: function () {\n        return gl.isVertexArray.apply(gl, arguments)\n      },\n      bindVertexArrayOES: function () {\n        return gl.bindVertexArray.apply(gl, arguments)\n      },\n    }\n\n    // mocks of instancing extension\n    extensions['angle_instanced_arrays'] = {\n      VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE: 0x88fe,\n      drawArraysInstancedANGLE: function () {\n        return gl.drawArraysInstanced.apply(gl, arguments)\n      },\n      drawElementsInstancedANGLE: function () {\n        return gl.drawElementsInstanced.apply(gl, arguments)\n      },\n      vertexAttribDivisorANGLE: function () {\n        return gl.vertexAttribDivisor.apply(gl, arguments)\n      },\n    }\n\n    return gl\n  },\n\n  versionProperty: '___regl_gl_version___',\n\n  // texture internal format to update on the fly\n  getInternalFormat: function (gl, format, type) {\n    if (gl[this.versionProperty] !== 2) {\n      return format\n    }\n    // WebGL2 texture formats\n    if (format === GL_DEPTH_COMPONENT) {\n      return gl.DEPTH_COMPONENT24\n    } else if (format === GL_DEPTH_STENCIL) {\n      return gl.DEPTH24_STENCIL8\n    } else if (type === HALF_FLOAT_OES && format === gl.RGBA) {\n      return gl.RGBA16F\n    } else if (type === HALF_FLOAT_OES && format === gl.RGB) {\n      return gl.RGB16F\n    } else if (type === gl.FLOAT && format === gl.RGBA) {\n      return gl.RGBA32F\n    } else if (type === gl.FLOAT && format === gl.RGB) {\n      return gl.RGB32F\n    } else if (format === gl.LUMINANCE && type === gl.FLOAT) {\n      return gl.R32F // Use R32F instead of LUMINANCE for float textures\n    } else if (format === gl.LUMINANCE) {\n      return gl.R8 // Use R8 instead of LUMINANCE for other types\n    }\n    return format\n  },\n\n  // texture type to update on the fly\n  getTextureType: function (gl, type) {\n    if (gl[this.versionProperty] !== 2) {\n      return type\n    }\n    if (type === HALF_FLOAT_OES) {\n      return gl.HALF_FLOAT\n    }\n    return type\n  },\n\n  // Add a new getFormat function\n  getFormat: function (gl, format) {\n    if (gl[this.versionProperty] !== 2) {\n      return format\n    }\n    if (format === gl.LUMINANCE) {\n      return gl.RED // Use RED instead of LUMINANCE in WebGL2\n    }\n    return format\n  },\n}\n\nexport default webgl2Compat\n","import React, {\n  createContext,\n  useCallback,\n  useState,\n  useEffect,\n  useContext,\n  useRef,\n} from 'react'\nimport _regl from 'regl'\n\nimport { webgl2Compat } from './webgl2-compat'\n\nexport const ReglContext = createContext(null)\n\nexport const useRegl = () => {\n  return useContext(ReglContext)\n}\n\nconst Regl = ({ style, extensions, children }) => {\n  const reglRef = useRef(null)\n  const [ready, setReady] = useState(false)\n\n  const ref = useCallback(\n    (node) => {\n      if (node !== null) {\n        const requiredExtensions = [\n          'OES_texture_float',\n          'OES_element_index_uint',\n          ...(extensions || []),\n        ]\n        try {\n          const canvas = document.createElement('canvas')\n          const context =\n            canvas.getContext('webgl') ||\n            canvas.getContext('experimental-webgl')\n          if (!context) {\n            throw new Error('WebGL is not supported in this browser.')\n          }\n          const missingExtensions = requiredExtensions.filter(\n            (ext) => !context.getExtension(ext)\n          )\n          canvas.remove()\n          if (missingExtensions.length > 0) {\n            // use webgl2 compat when missing extensions\n            console.log(\n              'using webgl2 compat due to missing extensions: ',\n              missingExtensions\n            )\n            reglRef.current = webgl2Compat.overrideContextType(() =>\n              _regl({\n                container: node,\n                extensions: requiredExtensions,\n              })\n            )\n          } else {\n            reglRef.current = _regl({\n              container: node,\n              extensions: requiredExtensions,\n            })\n          }\n          setReady(true)\n        } catch (err) {\n          console.error('Error initializing regl:', err)\n          throw err\n        }\n      }\n    },\n    [extensions]\n  )\n\n  useEffect(() => {\n    return () => {\n      if (reglRef.current) {\n        reglRef.current.destroy()\n        reglRef.current = null\n      }\n      setReady(false)\n    }\n  }, [])\n\n  return (\n    <ReglContext.Provider\n      value={{\n        regl: reglRef.current,\n      }}\n    >\n      <div ref={ref} style={{ width: '100%', height: '100%', ...style }} />\n      {ready && children}\n    </ReglContext.Provider>\n  )\n}\n\nexport default Regl\n","import React, { createContext, useContext, useState } from 'react'\n\nconst RegionContext = createContext({\n  region: null,\n  onChange: () => {\n    throw new Error('Tried to set region before initializing context')\n  },\n})\n\nexport const useRegionContext = () => {\n  return useContext(RegionContext)\n}\n\nexport const useRegion = () => {\n  const { region } = useContext(RegionContext)\n  return { region }\n}\n\nexport const RegionProvider = ({ children }) => {\n  const [region, setRegion] = useState(null)\n\n  return (\n    <RegionContext.Provider value={{ region, setRegion }}>\n      {children}\n    </RegionContext.Provider>\n  )\n}\n","import React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from 'react'\nimport { v4 as uuidv4 } from 'uuid'\n\nconst LoadingContext = createContext({})\n\nexport const useSetLoading = () => {\n  const loadingId = useRef(uuidv4())\n  const loading = useRef(false)\n  const { dispatch } = useContext(LoadingContext)\n  const [metadataIds, setMetadataIds] = useState(new Set())\n  const [chunkIds, setChunkIds] = useState(new Set())\n\n  useEffect(() => {\n    return () => {\n      const loaders = [{ id: loadingId.current, key: 'loading' }]\n      metadataIds.forEach((id) => loaders.push({ id, key: 'metadata' }))\n      chunkIds.forEach((id) => loaders.push({ id, key: 'chunk' }))\n      dispatch({ loaders, type: 'clear' })\n    }\n  }, [])\n\n  useEffect(() => {\n    if (loading.current && metadataIds.size === 0 && chunkIds.size === 0) {\n      dispatch({\n        loaders: [{ id: loadingId.current, key: 'loading' }],\n        type: 'clear',\n      })\n      loading.current = false\n    }\n  }, [metadataIds.size, chunkIds.size, loading.current])\n\n  const setLoading = useCallback((key = 'chunk') => {\n    if (!['chunk', 'metadata'].includes(key)) {\n      throw new Error(\n        `Unexpected loading key: ${key}. Expected one of: 'chunk', 'metadata'.`\n      )\n    }\n\n    const id = uuidv4()\n    const setter = key === 'metadata' ? setMetadataIds : setChunkIds\n    setter((prev) => {\n      prev.add(id)\n      return prev\n    })\n\n    const loaders = [{ id, key }]\n\n    if (!loading.current) {\n      loaders.push({ id: loadingId.current, key: 'loading' })\n      loading.current = true\n    }\n    dispatch({ loaders, type: 'set' })\n    return id\n  }, [])\n\n  const clearLoading = useCallback((id, { forceClear } = {}) => {\n    if (id) {\n      setMetadataIds((prevMetadata) => {\n        prevMetadata.delete(id)\n        return prevMetadata\n      })\n      setChunkIds((prevChunk) => {\n        prevChunk.delete(id)\n        return prevChunk\n      })\n\n      dispatch({\n        loaders: [\n          { id, key: 'metadata' },\n          { id, key: 'chunk' },\n        ],\n        type: 'clear',\n      })\n    }\n\n    if (forceClear && loading.current) {\n      dispatch({\n        loaders: [{ id: loadingId.current, key: 'loading' }],\n        type: 'clear',\n      })\n      loading.current = false\n    }\n  }, [])\n\n  return {\n    setLoading,\n    clearLoading,\n    loading: loading.current,\n    metadataLoading: metadataIds.size > 0,\n    chunkLoading: chunkIds.size > 0,\n  }\n}\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'set':\n      action.loaders.forEach(({ id, key }) => {\n        state[key].add(id)\n      })\n\n      return { ...state }\n    case 'clear':\n      action.loaders.forEach(({ id, key }) => {\n        state[key].delete(id)\n      })\n\n      return { ...state }\n    default:\n      throw new Error(`Unexpected action: ${action.type}`)\n  }\n}\n\nexport const LoadingProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, {\n    loading: new Set(),\n    metadata: new Set(),\n    chunk: new Set(),\n  })\n\n  return (\n    <LoadingContext.Provider\n      value={{\n        ...state,\n        dispatch,\n      }}\n    >\n      {children}\n    </LoadingContext.Provider>\n  )\n}\n\nexport const useLoadingContext = () => {\n  const { loading, metadata, chunk } = useContext(LoadingContext)\n\n  return {\n    loading: loading.size > 0,\n    metadataLoading: metadata.size > 0,\n    chunkLoading: chunk.size > 0,\n  }\n}\n","import { useEffect } from 'react'\n\nimport { useLoadingContext } from './context'\n\nexport const LoadingUpdater = ({\n  setLoading,\n  setMetadataLoading,\n  setChunkLoading,\n}) => {\n  const { loading, metadataLoading, chunkLoading } = useLoadingContext()\n\n  useEffect(() => {\n    if (setLoading) {\n      setLoading(loading)\n    }\n  }, [!!setLoading, loading])\n\n  useEffect(() => {\n    if (setMetadataLoading) {\n      setMetadataLoading(metadataLoading)\n    }\n  }, [!!setMetadataLoading, metadataLoading])\n\n  useEffect(() => {\n    if (setChunkLoading) {\n      setChunkLoading(chunkLoading)\n    }\n  }, [!!setChunkLoading, chunkLoading])\n\n  return null\n}\n","import React from 'react'\nimport Mapbox from './mapbox'\nimport Regl from './regl'\nimport { RegionProvider } from './region/context'\nimport { LoadingProvider, LoadingUpdater } from './loading'\n\nconst Map = ({\n  id,\n  tabIndex,\n  className,\n  style,\n  viewState, // add viewState\n  zoom,\n  minZoom,\n  maxZoom,\n  maxBounds,\n  center,\n  debug,\n  extensions,\n  glyphs,\n  children,\n  /** Tracks *any* pending requests made by containing `Raster` layers */\n  setLoading,\n  /** Tracks any metadata and coordinate requests made on initialization by containing `Raster` layers */\n  setMetadataLoading,\n  /** Tracks any requests of new chunks by containing `Raster` layers */\n  setChunkLoading,\n  mapRef, // Add this line\n  onMove,\n  onMoveStart,\n  onMoveEnd,\n  onViewStateChange,\n}) => {\n  console.log('on move function', onMove);\n  return (\n    <div\n      id={id}\n      tabIndex={tabIndex}\n      className={className}\n      style={{\n        position: 'relative',\n        width: '100%',\n        height: '100%',\n        overflow: 'hidden',\n        ...style,\n      }}\n    >\n      <Mapbox\n        viewState={viewState}\n        zoom={zoom}\n        minZoom={minZoom}\n        maxZoom={maxZoom}\n        maxBounds={maxBounds}\n        center={center}\n        debug={debug}\n        glyphs={glyphs}\n        style={{ position: 'absolute' }}\n        mapRef={mapRef} // Pass mapRef to Mapbox\n        onMove={onMove} // Forward event handlers\n        onMoveStart={onMoveStart}\n        onMoveEnd={onMoveEnd}\n        onViewStateChange={onViewStateChange}\n      >\n        <Regl\n          extensions={extensions}\n          style={{\n            position: 'absolute',\n            pointerEvents: 'none',\n            zIndex: -1,\n          }}\n        >\n          <LoadingProvider>\n            <LoadingUpdater\n              setLoading={setLoading}\n              setMetadataLoading={setMetadataLoading}\n              setChunkLoading={setChunkLoading}\n            />\n            <RegionProvider>{children}</RegionProvider>\n          </LoadingProvider>\n        </Regl>\n      </Mapbox>\n    </div>\n  )\n}\n\nexport default Map\n","import { geoPath, geoTransform } from 'd3-geo'\nimport mapboxgl from 'mapbox-gl'\n\nexport const project = (map, coordinates, options = {}) => {\n  // Convert any LngLatLike to LngLat\n  const ll = mapboxgl.LngLat.convert(coordinates)\n\n  let result = map.project(ll)\n\n  // When present, use referencePoint to find closest renderable point\n  const { referencePoint } = options\n  if (referencePoint) {\n    const deltas = [-360, 360]\n    deltas.forEach((delta) => {\n      const alternate = map.project({ lat: ll.lat, lng: ll.lng + delta })\n      if (\n        Math.abs(alternate.x - referencePoint.x) <\n        Math.abs(result.x - referencePoint.x)\n      ) {\n        result = alternate\n      }\n    })\n  }\n\n  return result\n}\n\nexport function getPathMaker(map, options) {\n  const transform = geoTransform({\n    point: function (lng, lat) {\n      const point = project(map, [lng, lat], options)\n      this.stream.point(point.x, point.y)\n    },\n  })\n  return geoPath().projection(transform)\n}\n","export default function CursorManager(map) {\n  const canvas = map.getCanvas()\n  const originalStyle = canvas.style.cursor\n\n  let mouseState = {\n    onHandle: false,\n    draggingHandle: false,\n    onCircle: false,\n    draggingCircle: false,\n  }\n\n  return function setCursor(newState) {\n    mouseState = {\n      ...mouseState,\n      ...newState,\n    }\n\n    if (mouseState.onHandle || mouseState.draggingHandle)\n      canvas.style.cursor = 'ew-resize'\n    else if (mouseState.onCircle || mouseState.draggingCircle)\n      canvas.style.cursor = 'move'\n    else canvas.style.cursor = originalStyle\n  }\n}\n","import { select } from 'd3-selection'\nimport { FLOATING_HANDLE, SHOW_RADIUS_GUIDELINE } from '../constants'\nimport { getPathMaker, project } from './utils'\nimport {\n  area,\n  convertArea,\n  distance,\n  rewind,\n  rhumbDestination,\n  lineString,\n  lineIntersect,\n  circle as turfCircle,\n  point,\n} from '@turf/turf'\nimport CursorManager from './cursor-manager'\n\nconst POLES = [point([0, -90]), point([0, 90])]\nconst abbreviations = {\n  kilometers: 'km',\n  miles: 'mi',\n}\n\nexport default function CircleRenderer({\n  id,\n  map,\n  onIdle = (circle) => {},\n  onDrag = (circle) => {},\n  initialCenter = { lat: 0, lng: 0 },\n  initialRadius = 0,\n  maxRadius,\n  minRadius,\n  units,\n}) {\n  let circle = null\n  let center = initialCenter\n  let centerXY = project(map, center)\n  let radius = initialRadius\n\n  const svg = select(`#circle-picker-${id}`).style('pointer-events', 'none')\n  const svgCircle = select(`#circle-${id}`).style('pointer-events', 'all')\n  const svgCircleCutout = select(`#circle-cutout-${id}`)\n  const svgHandle = select(`#handle-${id}`).style('pointer-events', 'all')\n  const svgGuideline = select(`#radius-guideline-${id}`)\n  const svgRadiusTextContainer = select(`#radius-text-container-${id}`)\n  const svgRadiusText = select(`#radius-text-${id}`).attr('fill-opacity', 0)\n\n  let guidelineAngle = 90\n  if (!SHOW_RADIUS_GUIDELINE) {\n    svgGuideline.style('display', 'none')\n    svgRadiusTextContainer.style('display', 'none')\n  }\n\n  const removers = []\n\n  //// LISTENERS ////\n\n  function addDragHandleListeners() {\n    const onMouseMove = (e) => {\n      let r = distance(\n        map.unproject(e.point).toArray(),\n        [center.lng, center.lat],\n        { units }\n      )\n      r = maxRadius ? Math.min(r, maxRadius) : r\n      r = minRadius ? Math.max(r, minRadius) : r\n      setRadius(r)\n      onDrag(circle)\n\n      if (FLOATING_HANDLE) {\n        const mouseXY = e.point\n        const rise = mouseXY.y - centerXY.y\n        const run = mouseXY.x - centerXY.x\n        let angle = (Math.atan(rise / run) * 180) / Math.PI\n        guidelineAngle = angle + 90 + (run < 0 ? 180 : 0)\n        setCircle()\n      }\n    }\n\n    const onMouseUp = () => {\n      onIdle(circle)\n      setCursor({ draggingHandle: false })\n      map.off('mousemove', onMouseMove)\n      map.off('touchmove', onMouseMove)\n      svgHandle.style('pointer-events', 'all')\n      svgCircle.style('pointer-events', 'all')\n      svgRadiusText.attr('fill-opacity', 0)\n      svgGuideline.attr('stroke-opacity', 0)\n    }\n\n    const handleStart = (e) => {\n      if (e.type === 'touchstart') {\n        map.dragPan.disable()\n        map.on('touchmove', onMouseMove)\n        map.once('touchend', onMouseUp)\n      } else {\n        map.on('mousemove', onMouseMove)\n        map.once('mouseup', onMouseUp)\n      }\n      setCursor({ draggingHandle: true })\n      svgHandle.style('pointer-events', 'none')\n      svgCircle.style('pointer-events', 'none')\n      svgRadiusText.attr('fill-opacity', 1)\n      svgGuideline.attr('stroke-opacity', 1)\n    }\n\n    svgHandle.on('mousedown', handleStart)\n    svgHandle.on('touchstart', handleStart)\n\n    removers.push(function removeDragHandleListeners() {\n      svgHandle.on('mousedown', null)\n      svgHandle.on('touchstart', null)\n    })\n  }\n\n  function addCircleListeners() {\n    let offset\n    const mapCanvas = map.getCanvas()\n\n    const onMouseMove = (e) => {\n      setCenter(\n        {\n          lng: e.lngLat.lng - offset.lng,\n          lat: e.lngLat.lat - offset.lat,\n        },\n        {\n          x: e.point.x,\n          y: e.point.y,\n        }\n      )\n      onDrag(circle)\n    }\n\n    const onMouseUp = () => {\n      onIdle(circle)\n      setCursor({ draggingCircle: false })\n      map.off('mousemove', onMouseMove)\n      map.off('touchmove', onMouseMove)\n      map.dragPan.enable()\n      svgCircle.style('pointer-events', 'all')\n      svgHandle.style('pointer-events', 'all')\n      svgCircle.attr('stroke-width', 1)\n    }\n\n    const handleCircleStart = (e) => {\n      let point\n      if (e.type === 'touchstart') {\n        const touch = e.touches[0]\n        point = { x: touch.pageX, y: touch.pageY }\n        svgCircle.attr('stroke-width', 4)\n        map.dragPan.disable()\n        map.on('touchmove', onMouseMove)\n        map.once('touchend', onMouseUp)\n      } else {\n        point = { x: e.offsetX, y: e.offsetY }\n        map.on('mousemove', onMouseMove)\n        map.once('mouseup', onMouseUp)\n      }\n      const lngLat = map.unproject(point)\n      offset = {\n        lng: lngLat.lng - center.lng,\n        lat: lngLat.lat - center.lat,\n      }\n      setCursor({ draggingCircle: true })\n      svgCircle.style('pointer-events', 'none')\n      svgHandle.style('pointer-events', 'none')\n    }\n\n    svgCircle.on('mousedown', handleCircleStart)\n    svgCircle.on('touchstart', handleCircleStart)\n\n    svgCircle.on('wheel', (e) => {\n      e.preventDefault()\n      let newEvent = new e.constructor(e.type, e)\n      mapCanvas.dispatchEvent(newEvent)\n    })\n\n    removers.push(function removeCircleListeners() {\n      svgCircle.on('mousedown', null)\n      svgCircle.on('touchstart', null)\n      svgCircle.on('wheel', null)\n    })\n  }\n\n  function addMapMoveListeners() {\n    const onMove = setCircle\n\n    map.on('move', onMove)\n    removers.push(function removeMapMoveListeners() {\n      map.off('move', onMove)\n    })\n  }\n\n  //// CIRCLE ////\n\n  function geoCircle(center, radius, inverted = false) {\n    const c = turfCircle([center.lng, center.lat], radius, {\n      units,\n      steps: 64,\n      properties: {\n        center,\n        radius,\n        units,\n      },\n    })\n\n    c.properties.area = convertArea(area(c), 'meters', units)\n    c.properties.zoom = map.getZoom()\n\n    if (inverted) {\n      return c\n    }\n\n    // need to rewind or svg fill is inside-out\n    return rewind(c, { reverse: true, mutate: true })\n  }\n\n  //// SETTERS ////\n\n  const setCursor = CursorManager(map)\n\n  function setCenter(_center, _point) {\n    if (_center && _center !== center) {\n      if (nearPoles(_center, radius)) {\n        center = { lng: _center.lng, lat: center.lat }\n        centerXY = { x: _point.x, y: centerXY.y }\n      } else {\n        center = _center\n        centerXY = _point\n      }\n\n      setCircle()\n    }\n  }\n\n  function resetCenterXY() {\n    // reset centerXY value based on latest `map` value\n    centerXY = project(map, center, { referencePoint: centerXY })\n  }\n\n  function setRadius(_radius) {\n    if (_radius && _radius !== radius) {\n      if (!nearPoles(center, _radius)) {\n        radius = _radius\n        setCircle()\n      }\n    }\n  }\n\n  function nearPoles(center, radius) {\n    const turfPoint = point([center.lng, center.lat])\n\n    return POLES.some((pole) => distance(turfPoint, pole, { units }) < radius)\n  }\n\n  function setCircle() {\n    // ensure that centerXY is up-to-date with map\n    resetCenterXY()\n\n    const makePath = getPathMaker(map, {\n      referencePoint: centerXY,\n    })\n\n    // update svg circle\n    circle = geoCircle(center, radius)\n    const path = makePath(circle)\n    svgCircle.attr('d', path)\n\n    // update cutout\n    const cutoutCircle = geoCircle(center, radius, true)\n    const cutoutPath = makePath(cutoutCircle)\n    const { width, height } = svg.node().getBBox()\n    svgCircleCutout.attr('d', cutoutPath + ` M0,0H${width}V${height}H0V0z`)\n\n    // update other svg elements\n    const handleXY = (() => {\n      // by default just render handle based on radius and guideline angle\n      let coordinates = rhumbDestination(\n        [center.lng, center.lat],\n        radius,\n        guidelineAngle\n      ).geometry.coordinates\n\n      const lineEnd = rhumbDestination(\n        [center.lng, center.lat],\n        radius * 2,\n        guidelineAngle\n      )\n      const line = lineString([\n        [center.lng, center.lat],\n        lineEnd.geometry.coordinates,\n      ])\n      const inter = lineIntersect(line, circle)\n      // but prefer rendering using intersection with circle to handle distortions near poles\n      if (inter.features.length > 0) {\n        coordinates = inter.features[0].geometry.coordinates\n      }\n\n      return project(map, coordinates, {\n        referencePoint: centerXY,\n      })\n    })()\n\n    svgHandle.attr('cx', handleXY.x).attr('cy', handleXY.y)\n\n    svgGuideline\n      .attr('x1', centerXY.x)\n      .attr('y1', centerXY.y)\n      .attr('x2', handleXY.x)\n      .attr('y2', handleXY.y)\n\n    const translateY = 4\n\n    svgRadiusText\n      .text(radius.toFixed(0) + abbreviations[units])\n      .attr(\n        'transform',\n        `rotate(${-1 * guidelineAngle + 90}) ` + `translate(0, ${translateY})`\n      )\n\n    const translateX = (() => {\n      const { width: textWidth } = svgRadiusText.node().getBBox()\n      const coeff = 0.8 * Math.sin((guidelineAngle * Math.PI) / 180)\n      return 18 + Math.abs((coeff * textWidth) / 2)\n    })()\n\n    svgRadiusTextContainer.attr(\n      'transform',\n      `rotate(${guidelineAngle - 90}, ${handleXY.x}, ${handleXY.y}) ` +\n        `translate(${handleXY.x + translateX}, ${handleXY.y})`\n    )\n  }\n\n  //// INIT ////\n\n  addDragHandleListeners()\n  addCircleListeners()\n  addMapMoveListeners()\n  setCircle()\n  onIdle(circle)\n\n  //// INTERFACE ////\n\n  return {\n    remove: () => {\n      removers.reverse().forEach((remove) => remove())\n      onIdle(null)\n    },\n  }\n}\n","import React, { useState, useEffect } from 'react'\nimport { useMapbox } from '../../../mapbox'\nimport CircleRenderer from './circle-renderer'\n\nconst CirclePicker = ({\n  id,\n  backgroundColor,\n  center,\n  color,\n  fontFamily,\n  fontSize,\n  radius,\n  onIdle,\n  onDrag,\n  units,\n  maxRadius,\n  minRadius,\n}) => {\n  const { map } = useMapbox()\n  const [renderer, setRenderer] = useState(null)\n\n  useEffect(() => {\n    const renderer = CircleRenderer({\n      id,\n      map,\n      onIdle,\n      onDrag,\n      initialCenter: center,\n      initialRadius: radius,\n      units,\n      maxRadius,\n      minRadius,\n    })\n\n    setRenderer(renderer)\n\n    return function cleanup() {\n      // need to check load state for fast-refresh purposes\n      if (map.loaded()) renderer.remove()\n    }\n  }, [])\n\n  return (\n    <svg\n      id={`circle-picker-${id}`}\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n      }}\n    >\n      <defs>\n        <clipPath id={`circle-clip-${id}`}>\n          <path id={`circle-cutout-${id}`} />\n        </clipPath>\n      </defs>\n\n      <path\n        id={`circle-${id}`}\n        stroke={color}\n        strokeWidth={1}\n        fill='transparent'\n        cursor='move'\n      />\n      <rect\n        x='0'\n        y='0'\n        width='100%'\n        height='100%'\n        clipPath={`url(#circle-clip-${id})`}\n        fill={backgroundColor}\n        fillOpacity={0.8}\n      />\n      <circle id={`handle-${id}`} r={8} fill={color} cursor='ew-resize' />\n      <line\n        id={`radius-guideline-${id}`}\n        stroke={color}\n        strokeOpacity={0}\n        strokeWidth={1}\n        strokeDasharray='3,2'\n      />\n      <g id={`radius-text-container-${id}`}>\n        <text\n          id={`radius-text-${id}`}\n          textAnchor='middle'\n          fontFamily={fontFamily}\n          fontSize={fontSize}\n          fill={color}\n        />\n      </g>\n    </svg>\n  )\n}\n\nexport default CirclePicker\n","import React, { useState, useRef, useCallback, useEffect } from 'react'\nimport CirclePicker from './circle-picker'\nimport { UPDATE_STATS_ON_DRAG } from './constants'\nimport { distance } from '@turf/turf'\nimport { v4 as uuidv4 } from 'uuid'\n\nimport { useRegionContext } from '../context'\nimport { useMapbox } from '../../mapbox'\nimport mapboxgl from 'mapbox-gl'\n\nfunction getInitialRadius(map, units, minRadius, maxRadius) {\n  const bounds = map.getBounds().toArray()\n  const dist = distance(bounds[0], bounds[1], { units })\n  let radius = Math.round(dist / 15)\n  radius = minRadius ? Math.max(minRadius, radius) : radius\n  radius = maxRadius ? Math.min(maxRadius, radius) : radius\n\n  return radius\n}\n\nfunction isValidCoordinate(longitude, latitude) {\n  return (\n    typeof longitude === 'number' &&\n    typeof latitude === 'number' &&\n    !isNaN(longitude) &&\n    !isNaN(latitude) &&\n    latitude >= -90 &&\n    latitude <= 90\n  )\n}\n\nfunction getInitialCenter(map, center) {\n  if (\n    Array.isArray(center) &&\n    center.length === 2 &&\n    isValidCoordinate(center[0], center[1])\n  ) {\n    return new mapboxgl.LngLat(center[0], center[1])\n  } else {\n    if (center) {\n      console.warn(\n        `Invalid initialCenter provided: ${center}. Should be [lng, lat]. Using map center instead.`\n      )\n    }\n    return map.getCenter()\n  }\n}\n\n// TODO:\n// - accept mode (only accept mode=\"circle\" to start)\nfunction RegionPicker({\n  backgroundColor,\n  color,\n  fontFamily,\n  fontSize,\n  units = 'kilometers',\n  initialRadius: initialRadiusProp,\n  initialCenter: initialCenterProp,\n  minRadius,\n  maxRadius,\n}) {\n  const { map } = useMapbox()\n  const id = useRef(uuidv4())\n\n  const initialCenter = useRef(getInitialCenter(map, initialCenterProp))\n\n  const initialRadius = useRef(\n    initialRadiusProp || getInitialRadius(map, units, minRadius, maxRadius)\n  )\n  const { setRegion } = useRegionContext()\n\n  const [center, setCenter] = useState(initialCenter.current)\n\n  useEffect(() => {\n    return () => {\n      // Clear region when unmounted\n      setRegion(null)\n    }\n  }, [])\n\n  const handleCircle = useCallback((circle) => {\n    if (!circle) return\n    setRegion(circle)\n    setCenter(circle.properties.center)\n  }, [])\n\n  // TODO: consider extending support for degrees and radians\n  if (!['kilometers', 'miles'].includes(units)) {\n    throw new Error('Units must be one of miles, kilometers')\n  }\n\n  return (\n    <CirclePicker\n      id={id.current}\n      map={map}\n      center={initialCenter.current}\n      radius={initialRadius.current}\n      onDrag={UPDATE_STATS_ON_DRAG ? handleCircle : undefined}\n      onIdle={handleCircle}\n      backgroundColor={backgroundColor}\n      color={color}\n      units={units}\n      fontFamily={fontFamily}\n      fontSize={fontSize}\n      maxRadius={maxRadius}\n      minRadius={minRadius}\n    />\n  )\n}\n\nexport default RegionPicker\n","import { useEffect, useState } from 'react'\n\nimport { useRegion } from './region/context'\nimport { useMapbox } from './mapbox'\n\nexport const useRecenterRegion = () => {\n  const [value, setValue] = useState({ recenterRegion: () => {} })\n  const { map } = useMapbox()\n  const { region } = useRegion()\n\n  const center = region?.properties?.center\n\n  useEffect(() => {\n    setValue({ recenterRegion: () => map.easeTo({ center }) })\n  }, [center])\n\n  return value\n}\n\nexport default useRecenterRegion\n","import React, { useState, useEffect, useCallback } from 'react'\nimport { flushSync } from 'react-dom'\nimport { useMapbox } from './mapbox'\n\nexport const useControls = () => {\n  const { map } = useMapbox()\n  const [zoom, setZoom] = useState(map.getZoom())\n  const [center, setCenter] = useState(map.getCenter())\n\n  const updateControlsSync = useCallback(() => {\n    flushSync(() => {\n      setZoom(map.getZoom())\n      setCenter(map.getCenter())\n    })\n  }, [])\n\n  useEffect(() => {\n    map.on('move', updateControlsSync)\n    return () => {\n      map.off('move', updateControlsSync)\n    }\n  }, [map])\n\n  return { center: center, zoom: zoom }\n}\n","import { mercatorInvert } from 'glsl-geo-projection'\n\nconst _sh = (mode) => {\n  return (value, which) => {\n    if (which.includes(mode)) return value\n    return ''\n  }\n}\n\nexport const vert = (mode, vars) => {\n  const sh = _sh(mode)\n\n  return `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n  #define PI 3.1415926535897932384626433832795\n\n  attribute vec2 position;\n  ${sh(`varying vec2 uv;`, ['texture'])}\n  ${sh(vars.map((d) => `attribute float ${d};`).join(''), ['grid', 'dotgrid'])}\n  ${sh(vars.map((d) => `varying float ${d}v;`).join(''), ['grid', 'dotgrid'])}\n  uniform vec2 camera;\n  uniform float viewportWidth;\n  uniform float viewportHeight;\n  uniform float pixelRatio;\n  uniform float zoom;\n  uniform float size;\n  uniform float globalLevel;\n  uniform float level;\n  uniform vec2 offset;\n  uniform vec2 order;\n  uniform float projection;\n  varying float latBase;\n  float mercatorYFromLat(float phi)\n  {\n    return (PI - log(tan(PI / 4.0 - phi / 2.0))) / (2.0 * PI);\n  }\n\n  void main() {\n    float scale = pixelRatio * 512.0 / size;\n    float globalMag = pow(2.0, zoom - globalLevel);\n    float mag = pow(2.0, zoom - level);\n\n    vec2 tileOffset = mag * (position + offset * size);\n    vec2 cameraOffset = globalMag * camera * size;\n    vec2 scaleFactor = vec2(order.x / viewportWidth, -1.0 * order.y / viewportHeight) * scale * 2.0;\n\n    float x = scaleFactor.x * (tileOffset.x - cameraOffset.x);\n\n    float y;\n    // Equirectangular\n    if (projection == 1.0) {\n      float numTiles = pow(2.0, level);\n      float sizeRad = PI / numTiles;\n      float stepRad = sizeRad / size;  \n      float latRad = order.y * (PI / 2.0 - (offset.y * sizeRad + position.y * stepRad));\n\n      // (0 => 1)\n      float posY = clamp(mercatorYFromLat(latRad), 0.0, 1.0);\n      // (-0.5 => 0.5)\n      posY = posY - 0.5;\n\n      y = -1.0 * order.y * scaleFactor.y * (pow(2.0, zoom) * size * posY + (cameraOffset.y - globalMag * size * pow(2.0, globalLevel) * 0.5));\n\n      // values when position.y = 0\n      latBase = order.y * (PI / 2.0 - (offset.y * sizeRad));\n    } else {\n      y = scaleFactor.y * (tileOffset.y - cameraOffset.y);\n    }\n\n    ${sh(`uv = vec2(position.y, position.x) / size;`, ['texture'])}\n    ${sh(vars.map((d) => `${d}v = ${d};`).join(''), ['grid', 'dotgrid'])}\n    ${sh(`gl_PointSize = 0.9 * scale * mag;`, ['grid', 'dotgrid'])}\n    gl_Position = vec4(x, y, 0.0, 1.0);\n  }`\n}\n\nexport const frag = (mode, vars, customFrag, customUniforms) => {\n  const sh = _sh(mode)\n\n  const declarations = `\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  #else\n  precision mediump float;\n  #endif\n  uniform float opacity;\n  uniform sampler2D colormap;\n  uniform vec2 clim;\n  uniform float fillValue;\n  uniform float projection;\n  uniform float viewportHeight;\n  uniform float pixelRatio;\n  uniform float zoom;\n  uniform float level;\n  uniform float centerY;\n  uniform vec2 order;\n  varying float latBase;\n  ${sh(`varying vec2 uv;`, ['texture'])}\n  ${sh(vars.map((d) => `uniform sampler2D ${d};`).join(''), ['texture'])}\n  ${sh(vars.map((d) => `varying float ${d}v;`).join(''), ['grid', 'dotgrid'])}\n  ${customUniforms.map((d) => `uniform float ${d};`).join('')}\n  `\n\n  if (!customFrag)\n    return `\n    ${declarations}\n    ${mercatorInvert}\n    #define PI 3.1415926535897932384626433832795\n\n    void main() {\n      ${sh(\n        `\n      // By default (mercator projection), index into vars[0] using uv\n      vec2 coord = uv;\n\n      // Equirectangular\n      if (projection == 1.0) {\n        float scale = pixelRatio * 512.0;\n        float mag = pow(2.0, zoom);\n        float numTiles = pow(2.0, level);\n        float sizeRad = PI / numTiles;\n\n        // (1 => 0)\n        float y = gl_FragCoord.y / viewportHeight;\n        // (1 => 0)\n        float delta = 1.0 - centerY;\n        float mercatorY = viewportHeight * (y - 0.5) / (scale * mag) + delta;\n        vec2 lookup = mercatorInvert((uv.y * 2.0 - 1.0) * PI, (mercatorY * 2.0 - 1.0) * PI);\n        float rescaledX = lookup.x / 360.0 + 0.5;\n        float rescaledY = order.y * (latBase - radians(lookup.y)) / sizeRad;\n\n        coord = vec2(rescaledY, rescaledX);\n      }\n\n      float ${vars[0]} = texture2D(${vars[0]}, coord).x;\n      `,\n        ['texture']\n      )}\n      ${sh(`float ${vars[0]} = ${vars[0]}v;`, ['grid', 'dotgrid'])}\n      ${sh(\n        `\n      if (length(gl_PointCoord.xy - 0.5) > 0.5) {\n        discard;\n      }\n      `,\n        ['dotgrid']\n      )}\n      if (${vars[0]} == fillValue) {\n        discard;\n      }\n      float rescaled = (${vars[0]} - clim.x)/(clim.y - clim.x);\n      vec4 c = texture2D(colormap, vec2(rescaled, 1.0));\n      gl_FragColor = vec4(c.x, c.y, c.z, opacity);\n      gl_FragColor.rgb *= gl_FragColor.a;\n    }`\n\n  if (customFrag)\n    return `\n    ${declarations}\n    void main() {\n      ${sh(\n        `${vars.map((d) => `float ${d} = texture2D(${d}, uv).x;`).join('')}`,\n        ['texture']\n      )}\n      ${sh(`${vars.map((d) => `float ${d} = ${d}v;`).join('')}`, [\n        'grid',\n        'dotgrid',\n      ])}\n      ${customFrag}\n    }`\n}\n","import { point, rhumbBearing, rhumbDestination } from '@turf/turf'\n\nconst d2r = Math.PI / 180\n\nconst clip = (v, max) => {\n  let result\n  if (v < 0) {\n    result = v + max + 1\n  } else if (v > max) {\n    result = v - max - 1\n  } else {\n    result = v\n  }\n\n  return Math.min(Math.max(result, 0), max)\n}\n\nexport const keyToTile = (key) => {\n  return key.split(',').map((d) => parseInt(d))\n}\n\nexport const tileToKey = (tile) => {\n  return tile.join(',')\n}\n\nexport const pointToTile = (lon, lat, z, projection, order) => {\n  const z2 = Math.pow(2, z)\n\n  let tile\n  switch (projection) {\n    case 'mercator':\n      tile = pointToCamera(lon, lat, z, projection)\n      break\n    case 'equirectangular':\n      let x = z2 * (lon / 360 + 0.5)\n      let y = z2 * ((order[1] * -1 * lat) / 180 + 0.5)\n\n      x = x % z2\n      if (x < 0) x = x + z2\n      y = Math.max(Math.min(y, z2), 0)\n      tile = [x, y, z]\n      break\n    default:\n      return\n  }\n  tile[0] = Math.floor(tile[0])\n  tile[1] = Math.min(Math.floor(tile[1]), z2 - 1)\n\n  return tile\n}\n\nexport const pointToCamera = (lon, lat, z) => {\n  const sin = Math.sin(lat * d2r)\n  const z2 = Math.pow(2, z)\n\n  let x = z2 * (lon / 360 + 0.5)\n  let y = z2 * (0.5 - (0.25 * Math.log((1 + sin) / (1 - sin))) / Math.PI)\n\n  x = x % z2\n  y = Math.max(Math.min(y, z2), 0)\n  if (x < 0) x = x + z2\n  return [x, y, z]\n}\n\nexport const cameraToPoint = (x, y, z) => {\n  const z2 = Math.pow(2, z)\n\n  const lon = 360 * (x / z2) - 180\n\n  const y2 = 180 - (y / z2) * 360\n  const lat = (360 / Math.PI) * Math.atan(Math.exp((y2 * Math.PI) / 180)) - 90\n\n  return [lon, lat]\n}\n\nexport const zoomToLevel = (zoom, maxZoom) => {\n  if (maxZoom) return Math.min(Math.max(0, Math.floor(zoom)), maxZoom)\n  return Math.max(0, Math.floor(zoom))\n}\n\nexport const mercatorYFromLat = (lat) => {\n  return (\n    (180 -\n      (180 / Math.PI) *\n        Math.log(Math.tan(Math.PI / 4 + (lat * Math.PI) / 360))) /\n    360\n  )\n}\n\nconst getOffsets = (length, tileSize, cameraOffset, order) => {\n  const siblingCount = (length - tileSize) / tileSize\n\n  // Do not add offset for very small fraction of tile\n  if (Math.abs(siblingCount) < 0.001) {\n    return [0, 0]\n  }\n\n  const prev = siblingCount / 2 + 0.5 - cameraOffset\n  const next = siblingCount - prev\n\n  let result = [-1 * Math.ceil(prev), Math.ceil(next)]\n  if (order === -1) {\n    result = [-1 * Math.ceil(next), Math.ceil(prev)]\n  }\n  return result\n}\n\nconst getTileOffsets = (length, tileSize, camera, order) => {\n  const cameraOffset = camera - Math.floor(camera)\n\n  return getOffsets(length, tileSize, cameraOffset, order)\n}\n\nconst getLatBasedOffsets = (tile, { zoom, length, order, camera }) => {\n  const [x, y, z] = tile\n  const z2 = Math.pow(2, z)\n  const sizeDeg = 180 / z2\n\n  const lat0 = order * (90 - y * sizeDeg)\n  const lat1 = lat0 - order * sizeDeg\n\n  const y0 = Math.max(Math.min(mercatorYFromLat(lat0), 1), 0)\n  const y1 = Math.max(Math.min(mercatorYFromLat(lat1), 1), 0)\n\n  const magnification = Math.pow(2, zoom - z)\n  const scale = window.devicePixelRatio * 512 * magnification\n  const tileSize = Math.abs(y1 - y0) * scale\n\n  const cameraOffset = camera - Math.pow(2, z) * (order === 1 ? y0 : y1)\n\n  return getOffsets(length, tileSize, cameraOffset, order)\n}\n\n// Given a tile, return an object mapping sibling tiles (including itself) mapped to the different locations to render\n// For example, { '0.0.0':  [ [0,0,0], [1,0,0] ] }\nexport const getSiblings = (\n  tile,\n  { viewport, zoom, size, camera, order, projection }\n) => {\n  const [tileX, tileY, tileZ] = tile\n  const { viewportHeight, viewportWidth } = viewport\n  const [cameraX, cameraY] = camera\n\n  const magnification = Math.pow(2, zoom - tileZ)\n  const scale = window.devicePixelRatio * 512 * magnification\n\n  const deltaX = getTileOffsets(viewportWidth, scale, cameraX, order[0])\n  const deltaY =\n    projection === 'equirectangular'\n      ? getLatBasedOffsets(tile, {\n          zoom,\n          length: viewportHeight,\n          order: order[1],\n          camera: cameraY,\n        })\n      : getTileOffsets(viewportHeight, scale, cameraY, order[1])\n\n  // offsets in units of tiles\n  let offsets = []\n  for (let x = deltaX[0]; x <= deltaX[1]; x++) {\n    for (let y = deltaY[0]; y <= deltaY[1]; y++) {\n      offsets.push([tileX + x, tileY + y, tileZ])\n    }\n  }\n\n  const max = Math.pow(2, tileZ) - 1\n  return offsets.reduce((accum, offset) => {\n    const [x, y, z] = offset\n\n    // Do not attempt to wrap in y direction\n    if (y < 0 || y > max) {\n      return accum\n    }\n    const tile = [clip(x, max), clip(y, max), z]\n    const key = tileToKey(tile)\n\n    if (!accum[key]) {\n      accum[key] = []\n    }\n\n    accum[key].push(offset)\n\n    return accum\n  }, {})\n}\n\nexport const getKeysToRender = (targetKey, tiles, maxZoom) => {\n  const ancestor = getAncestorToRender(targetKey, tiles)\n\n  if (ancestor) {\n    return [ancestor]\n  }\n\n  const descendants = getDescendantsToRender(targetKey, tiles, maxZoom)\n  if (descendants.length) {\n    return descendants\n  }\n\n  return [targetKey]\n}\n\nexport const getAncestorToRender = (targetKey, tiles) => {\n  let [x, y, z] = keyToTile(targetKey)\n  while (z >= 0) {\n    const key = tileToKey([x, y, z])\n    if (tiles[key].isBufferPopulated()) {\n      return key\n    }\n    z--\n    x = Math.floor(x / 2)\n    y = Math.floor(y / 2)\n  }\n}\n\nexport const getDescendantsToRender = (targetKey, tiles, maxZoom) => {\n  let [initialX, initialY, initialZ] = keyToTile(targetKey)\n  let [x, y, z] = [initialX, initialY, initialZ]\n  let coverage = 0\n  let descendants = []\n  while (z <= maxZoom) {\n    const delta = z - initialZ\n    const keys = []\n    for (let deltaX = 0; deltaX <= delta; deltaX++) {\n      for (let deltaY = 0; deltaY <= delta; deltaY++) {\n        keys.push(tileToKey([x + deltaX, y + deltaY, z]))\n      }\n    }\n\n    const coveringKeys = keys.filter((key) => tiles[key].isBufferPopulated())\n    const currentCoverage = coveringKeys.length / keys.length\n\n    if (coverage === 1) {\n      return keys\n    } else if (currentCoverage > coverage) {\n      descendants = keys\n    }\n\n    z++\n    x = x * 2\n    y = y * 2\n  }\n\n  return descendants\n}\n\nexport const getOverlappingAncestor = (key, renderedKeys) => {\n  const [aX, aY, aZ] = keyToTile(key)\n  const child = { x: aX, y: aY, z: aZ }\n\n  return renderedKeys.find((parentKey) => {\n    const [bX, bY, bZ] = keyToTile(parentKey)\n    const parent = { x: bX, y: bY, z: bZ }\n\n    if (child.z <= parent.z) {\n      return false\n    } else {\n      const factor = Math.pow(2, child.z - parent.z)\n\n      return (\n        Math.floor(child.x / factor) === parent.x &&\n        Math.floor(child.y / factor) === parent.y\n      )\n    }\n  })\n}\n\n// Given a `renderedKey` for a tile to be rendered at some offset on the map,\n// return offset for rendering in context of map\nexport const getAdjustedOffset = (offset, renderedKey) => {\n  const [renderedX, renderedY, renderedLevel] = keyToTile(renderedKey)\n  const [offsetX, offsetY, level] = offset\n\n  // Overall factor to scale offset by\n  const factor = Math.pow(2, level - renderedLevel)\n\n  // Factor used to calculate adjustment when rendering a descendant tile\n  const descendantFactor =\n    renderedLevel > level ? Math.pow(2, renderedLevel - level) : 1\n\n  return [\n    Math.floor(offsetX / factor) + (renderedX % descendantFactor),\n    Math.floor(offsetY / factor) + (renderedY % descendantFactor),\n  ]\n}\n\nexport const getTilesOfRegion = (region, level, projection, order) => {\n  const { center, radius, units } = region.properties\n  const centralTile = pointToTile(\n    center.lng,\n    center.lat,\n    level,\n    projection,\n    order\n  )\n\n  const tiles = new Set([tileToKey(centralTile)])\n\n  region.geometry.coordinates[0].forEach(([lng, lat]) => {\n    // Add tile along edge of region\n    const edgeTile = pointToTile(lng, lat, level, projection, order)\n    tiles.add(tileToKey(edgeTile))\n\n    // Add any intermediate tiles if edge is > 1 tile away from center\n    const maxDiff = Math.max(\n      Math.abs(edgeTile[0] - centralTile[0]),\n      Math.abs(edgeTile[1] - centralTile[1])\n    )\n    if (maxDiff > 1) {\n      const centerPoint = point([center.lng, center.lat])\n      const bearing = rhumbBearing(centerPoint, point([lng, lat]))\n\n      for (let i = 1; i < maxDiff; i++) {\n        const intermediatePoint = rhumbDestination(\n          centerPoint,\n          (i * radius) / maxDiff,\n          bearing,\n          { units }\n        )\n        const intermediateTile = pointToTile(\n          intermediatePoint.geometry.coordinates[0],\n          intermediatePoint.geometry.coordinates[1],\n          level,\n          projection,\n          order\n        )\n        tiles.add(tileToKey(intermediateTile))\n      }\n    }\n  })\n\n  return Array.from(tiles)\n}\n\nexport const getPyramidMetadata = (multiscales) => {\n  if (!multiscales) {\n    throw new Error(\n      'Missing `multiscales` value in metadata. Please check your pyramid generation code.'\n    )\n  }\n\n  const datasets = multiscales[0].datasets\n\n  if (!datasets || datasets.length === 0) {\n    throw new Error(\n      'No datasets provided in `multiscales` metadata. Please check your pyramid generation code.'\n    )\n  }\n\n  const levels = datasets.map((dataset) => Number(dataset.path))\n  const maxZoom = Math.max(...levels)\n  const tileSize = datasets[0].pixels_per_tile\n  let crs = datasets[0].crs\n\n  if (!tileSize) {\n    throw new Error(\n      'Missing required `pixels_per_tile` value in `multiscales` metadata. Please check your pyramid generation code.'\n    )\n  }\n\n  if (!crs) {\n    console.warn(\n      'Missing `crs` value in `multiscales` metadata. Please check your pyramid generation code. Falling back to `crs=EPSG:3857` (Web Mercator)'\n    )\n    crs = 'EPSG:3857'\n  }\n  return { levels, maxZoom, tileSize, crs }\n}\n\n/**\n * Given a selector, generates an Object mapping each bandName to an Object\n * representing which values of each dimension that bandName represents.\n * @param {selector} Object of {[dimension]: dimensionValue|Array<dimensionValue>} pairs\n * @returns Object containing bandName, {[dimension]: dimensionValue} pairs\n */\nexport const getBandInformation = (selector) => {\n  const combinedBands = Object.keys(selector)\n    .filter((key) => Array.isArray(selector[key]))\n    .reduce((bandMapping, selectorKey) => {\n      const values = selector[selectorKey]\n      let keys\n      if (typeof values[0] === 'string') {\n        keys = values\n      } else {\n        keys = values.map((d) => selectorKey + '_' + d)\n      }\n\n      const bands = Object.keys(bandMapping)\n      const updatedBands = {}\n      keys.forEach((key, i) => {\n        if (bands.length > 0) {\n          bands.forEach((band) => {\n            const bandKey = `${band}_${key}`\n            updatedBands[bandKey] = {\n              ...bandMapping[band],\n              [selectorKey]: values[i],\n            }\n          })\n        } else {\n          updatedBands[key] = { [selectorKey]: values[i] }\n        }\n      })\n\n      return updatedBands\n    }, {})\n\n  Object.keys(selector).forEach((key) => {\n    if (!Array.isArray(selector[key])) {\n      Object.keys(combinedBands).forEach((combinedKey) => {\n        combinedBands[combinedKey][key] = selector[key]\n      })\n    }\n  })\n  return combinedBands\n}\n\nexport const getBands = (variable, selector = {}) => {\n  const bandInfo = getBandInformation(selector)\n  const bandNames = Object.keys(bandInfo)\n\n  if (bandNames.length > 0) {\n    return bandNames\n  } else {\n    return [variable]\n  }\n}\n\n/**\n * Mutates a given object by adding `value` to array at nested location specified by `keys`\n * @param {obj} Object of any structure\n * @param {Array<string>} keys describing nested location where value should be set\n * @param {any} value to be added to array at location specified by keys\n * @returns reference to updated obj\n */\nexport const setObjectValues = (obj, keys, value) => {\n  let ref = obj\n  keys.forEach((key, i) => {\n    if (i === keys.length - 1) {\n      if (!ref[key]) {\n        ref[key] = []\n      }\n    } else {\n      if (!ref[key]) {\n        ref[key] = {}\n      }\n    }\n    ref = ref[key]\n  })\n\n  ref.push(value)\n  return obj\n}\n\nexport const getSelectorHash = (selector) => {\n  return JSON.stringify(selector)\n}\n\nexport const getChunks = (\n  selector,\n  dimensions,\n  coordinates,\n  shape,\n  chunks,\n  x,\n  y\n) => {\n  const chunkIndicesToUse = dimensions.map((dimension, i) => {\n    if (['x', 'lon'].includes(dimension)) {\n      return [x]\n    } else if (['y', 'lat'].includes(dimension)) {\n      return [y]\n    }\n\n    const selectorValue = selector[dimension]\n    const coords = coordinates[dimension]\n    const chunkSize = chunks[i]\n    let indices\n    if (Array.isArray(selectorValue)) {\n      // Return all indices of selector value when array\n      indices = selectorValue.map((v) => coords.indexOf(v))\n    } else if (selectorValue != undefined) {\n      // Return index of single selector value otherwise when present\n      indices = [coords.indexOf(selectorValue)]\n    } else {\n      // Otherwise, vary over the entire shape of the dimension\n      indices = Array(shape[i])\n        .fill(null)\n        .map((_, j) => j)\n    }\n\n    return (\n      indices\n        .map((index) => Math.floor(index / chunkSize))\n        // Filter out repeated instances of indices\n        .filter((v, i, a) => a.indexOf(v) === i)\n    )\n  })\n\n  let result = [[]]\n  chunkIndicesToUse.forEach((indices) => {\n    const updatedResult = []\n    indices.forEach((index) => {\n      result.forEach((prev) => {\n        updatedResult.push([...prev, index])\n      })\n    })\n    result = updatedResult\n  })\n\n  return result\n}\n\nexport const getPositions = (size, mode) => {\n  let position = []\n  if (mode === 'grid' || mode === 'dotgrid') {\n    for (let i = 0; i < size; i++) {\n      for (let j = 0; j < size; j++) {\n        position.push([j + 0.5, i + 0.5])\n      }\n    }\n  }\n  if (mode === 'texture') {\n    position = [\n      0.0,\n      0.0,\n      0.0,\n      size,\n      size,\n      0.0,\n      size,\n      0.0,\n      0.0,\n      size,\n      size,\n      size,\n    ]\n  }\n  return position\n}\n\nexport const updatePaintProperty = (map, ref, key, value) => {\n  const { current: id } = ref\n  if (map.getLayer(id)) {\n    map.setPaintProperty(id, key, value)\n  }\n}\n","// mirrors https://github.com/carbonplan/ndpyramid/blob/41f2bedeb3297db7e299285ca43363f9c0c1a65e/ndpyramid/utils.py#L14-L25\nexport const DEFAULT_FILL_VALUES = {\n  '|S1': '\\x00',\n  '<i1': -127,\n  '|u1': 255,\n  '<i2': -32767,\n  '<u2': 65535,\n  '<i4': -2147483647,\n  '<u4': 4294967295,\n  // '<i8': -9223372036854775806,\n  '<u8': 18446744073709551614,\n  '<f4': 9.969209968386869e36,\n  '<f8': 9.969209968386869e36,\n}\n","import {\n  getBandInformation,\n  getChunks,\n  keyToTile,\n  getSelectorHash,\n} from './utils'\n\nclass Tile {\n  constructor({\n    key,\n    loader,\n    shape,\n    chunks,\n    dimensions,\n    coordinates,\n    bands,\n    initializeBuffer,\n  }) {\n    this.key = key\n    this.tileCoordinates = keyToTile(key)\n\n    this.shape = shape\n    this.chunks = chunks\n    this.dimensions = dimensions\n    this.coordinates = coordinates\n    this.bands = bands\n\n    this._bufferCache = null\n    this._buffers = {}\n\n    this._loading = {}\n    this._ready = {}\n\n    bands.forEach((k) => {\n      this._buffers[k] = initializeBuffer()\n    })\n\n    this.chunkedData = {}\n\n    this._loader = loader\n  }\n\n  getBuffers() {\n    return this._buffers\n  }\n\n  async loadChunks(chunks) {\n    const updated = await Promise.all(\n      chunks.map(\n        (chunk) =>\n          new Promise((resolve) => {\n            const key = chunk.join('.')\n            if (this.chunkedData[key]) {\n              resolve(false)\n            } else {\n              this._loading[key] = true\n              this._ready[key] = new Promise((innerResolve) => {\n                this._loader(chunk, (err, data) => {\n                  this.chunkedData[key] = data\n                  this._loading[key] = false\n                  innerResolve(true)\n                  resolve(true)\n                })\n              })\n            }\n          })\n      )\n    )\n\n    return updated.some(Boolean)\n  }\n\n  async populateBuffers(chunks, selector) {\n    const updated = await this.loadChunks(chunks)\n\n    this.populateBuffersSync(selector)\n\n    return updated\n  }\n\n  populateBuffersSync(selector) {\n    const bandInformation = getBandInformation(selector)\n\n    this.bands.forEach((band) => {\n      const info = bandInformation[band] || selector\n      const chunks = getChunks(\n        info,\n        this.dimensions,\n        this.coordinates,\n        this.shape,\n        this.chunks,\n        this.tileCoordinates[0],\n        this.tileCoordinates[1]\n      )\n\n      if (chunks.length !== 1) {\n        throw new Error(\n          `Expected 1 chunk for band '${band}', found ${\n            chunks.length\n          }: ${chunks.join(', ')}`\n        )\n      }\n      const chunk = chunks[0]\n      const chunkKey = chunk.join('.')\n      const data = this.chunkedData[chunkKey]\n\n      if (!data) {\n        throw new Error(`Missing data for chunk: ${chunkKey}`)\n      }\n\n      let bandData = data\n      if (info) {\n        const indices = this.dimensions\n          .map((d) => (['x', 'y'].includes(d) ? null : d))\n          .map((d, i) => {\n            if (info[d] === undefined) {\n              return null\n            } else {\n              const value = info[d]\n              return (\n                this.coordinates[d].findIndex(\n                  (coordinate) => coordinate === value\n                ) % this.chunks[i]\n              )\n            }\n          })\n\n        bandData = data.pick(...indices)\n      }\n\n      if (bandData.dimension !== 2) {\n        throw new Error(\n          `Unexpected data dimensions for band: ${band}. Found ${bandData.dimension}, expected 2. Check the selector value.`\n        )\n      }\n      this._buffers[band](bandData)\n    })\n\n    this._bufferCache = getSelectorHash(selector)\n  }\n\n  isBufferPopulated() {\n    return !!this._bufferCache\n  }\n\n  isLoading() {\n    return Object.keys(this._loading).some((key) => this._loading[key])\n  }\n\n  isLoadingChunks(chunks) {\n    return chunks.every((chunk) => this._loading[chunk.join('.')])\n  }\n\n  async chunksLoaded(chunks) {\n    await Promise.all(chunks.map((chunk) => this._ready[chunk.join('.')]))\n\n    return true\n  }\n\n  hasLoadedChunks(chunks) {\n    return chunks.every((chunk) => this.chunkedData[chunk.join('.')])\n  }\n\n  hasPopulatedBuffer(selector) {\n    return (\n      !!this._bufferCache && this._bufferCache === getSelectorHash(selector)\n    )\n  }\n\n  getPointValues({ selector, point: [x, y] }) {\n    const result = []\n    const chunks = getChunks(\n      selector,\n      this.dimensions,\n      this.coordinates,\n      this.shape,\n      this.chunks,\n      this.tileCoordinates[0],\n      this.tileCoordinates[1]\n    )\n\n    chunks.forEach((chunk) => {\n      const key = chunk.join('.')\n      const chunkData = this.chunkedData[key]\n\n      if (!chunkData) {\n        throw new Error(`Missing data for chunk: ${key}`)\n      }\n\n      const combinedIndices = this.chunks.reduce(\n        (accum, count, i) => {\n          const dimension = this.dimensions[i]\n          const chunkOffset = chunk[i] * count\n\n          if (['x', 'lon'].includes(dimension)) {\n            return accum.map((prev) => [...prev, x])\n          } else if (['y', 'lat'].includes(dimension)) {\n            return accum.map((prev) => [...prev, y])\n          } else if (selector.hasOwnProperty(dimension)) {\n            const selectorValues = Array.isArray(selector[dimension])\n              ? selector[dimension]\n              : [selector[dimension]]\n            const selectorIndices = selectorValues\n              .map((value) => this.coordinates[dimension].indexOf(value))\n              .filter(\n                (index) => chunkOffset <= index && index < chunkOffset + count\n              )\n\n            return selectorIndices.reduce((a, index) => {\n              return a.concat(accum.map((prev) => [...prev, index]))\n            }, [])\n          } else {\n            let updatedAccum = []\n\n            for (let j = 0; j < count; j++) {\n              const index = chunkOffset + j\n              updatedAccum = updatedAccum.concat(\n                accum.map((prev) => [...prev, index])\n              )\n            }\n\n            return updatedAccum\n          }\n        },\n        [[]]\n      )\n\n      combinedIndices.forEach((indices) => {\n        const keys = indices.reduce((accum, el, i) => {\n          const coordinates = this.coordinates[this.dimensions[i]]\n          const selectorValue = selector[this.dimensions[i]]\n\n          if (\n            coordinates &&\n            (Array.isArray(selectorValue) || selectorValue == undefined)\n          ) {\n            accum.push(coordinates[el])\n          }\n\n          return accum\n        }, [])\n        const chunkIndices = indices.map((el, i) =>\n          ['x', 'lon', 'y', 'lat'].includes(this.dimensions[i])\n            ? el\n            : el - chunk[i] * this.chunks[i]\n        )\n        result.push({\n          keys,\n          value: chunkData.get(...chunkIndices),\n        })\n      })\n    })\n\n    return result\n  }\n}\n\nexport default Tile\n","import zarr from 'zarr-js'\n\nimport { getPyramidMetadata } from './utils'\n\nconst initializeStore = async (source, version, variable, coordinateKeys) => {\n  let metadata\n  let loaders\n  let dimensions\n  let shape\n  let chunks\n  let fill_value\n  let dtype\n  let levels, maxZoom, tileSize, crs\n  const coordinates = {}\n  switch (version) {\n    case 'v2':\n      await new Promise((resolve) =>\n        zarr(window.fetch, version).openGroup(source, (err, l, m) => {\n          loaders = l\n          metadata = m\n          resolve()\n        })\n      )\n      ;({ levels, maxZoom, tileSize, crs } = getPyramidMetadata(\n        metadata.metadata['.zattrs'].multiscales\n      ))\n\n      const zattrs = metadata.metadata[`${levels[0]}/${variable}/.zattrs`]\n      const zarray = metadata.metadata[`${levels[0]}/${variable}/.zarray`]\n      dimensions = zattrs['_ARRAY_DIMENSIONS']\n      shape = zarray.shape\n      chunks = zarray.chunks\n      fill_value = zarray.fill_value\n      dtype = zarray.dtype\n\n      await Promise.all(\n        coordinateKeys.map(\n          (key) =>\n            new Promise((resolve) => {\n              loaders[`${levels[0]}/${key}`]([0], (err, chunk) => {\n                coordinates[key] = Array.from(chunk.data)\n                resolve()\n              })\n            })\n        )\n      )\n\n      break\n    case 'v3':\n      metadata = await fetch(`${source}/zarr.json`).then((res) => res.json())\n      ;({ levels, maxZoom, tileSize, crs } = getPyramidMetadata(\n        metadata.attributes.multiscales\n      ))\n\n      const arrayMetadata = await fetch(\n        `${source}/${levels[0]}/${variable}/zarr.json`\n      ).then((res) => res.json())\n\n      dimensions = arrayMetadata.attributes['_ARRAY_DIMENSIONS']\n      shape = arrayMetadata.shape\n      const isSharded = arrayMetadata.codecs[0].name == 'sharding_indexed'\n      chunks = isSharded\n        ? arrayMetadata.codecs[0].configuration.chunk_shape\n        : arrayMetadata.chunk_grid.configuration.chunk_shape\n      fill_value = arrayMetadata.fill_value\n      // dtype = arrayMetadata.data_type\n\n      loaders = {}\n      await Promise.all([\n        ...levels.map(\n          (level) =>\n            new Promise((resolve) => {\n              zarr(window.fetch, version).open(\n                `${source}/${level}/${variable}`,\n                (err, get) => {\n                  loaders[`${level}/${variable}`] = get\n                  resolve()\n                },\n                level === 0 ? arrayMetadata : null\n              )\n            })\n        ),\n        ...coordinateKeys.map(\n          (key) =>\n            new Promise((resolve) => {\n              zarr(window.fetch, version).open(\n                `${source}/${levels[0]}/${key}`,\n                (err, get) => {\n                  get([0], (err, chunk) => {\n                    coordinates[key] = Array.from(chunk.data)\n                    resolve()\n                  })\n                }\n              )\n            })\n        ),\n      ])\n      break\n    default:\n      throw new Error(\n        `Unexpected Zarr version: ${version}. Must be one of 'v1', 'v2'.`\n      )\n  }\n\n  return {\n    metadata,\n    loaders,\n    dimensions,\n    shape,\n    chunks,\n    fill_value,\n    dtype,\n    coordinates,\n    levels,\n    maxZoom,\n    tileSize,\n    crs,\n  }\n}\n\nexport default initializeStore\n","import ndarray from 'ndarray'\nimport { distance } from '@turf/turf'\n\nimport { vert, frag } from './shaders'\nimport {\n  zoomToLevel,\n  keyToTile,\n  pointToCamera,\n  pointToTile,\n  getPositions,\n  getSiblings,\n  getKeysToRender,\n  getAdjustedOffset,\n  getOverlappingAncestor,\n  cameraToPoint,\n  getTilesOfRegion,\n  getBands,\n  setObjectValues,\n  getChunks,\n  getSelectorHash,\n  mercatorYFromLat,\n} from './utils'\nimport { DEFAULT_FILL_VALUES } from './constants'\nimport Tile from './tile'\nimport initializeStore from './initialize-store'\n\nexport const createTiles = (regl, opts) => {\n  return new Tiles(opts)\n\n  function Tiles({\n    source,\n    colormap,\n    clim,\n    opacity,\n    display,\n    variable,\n    selector = {},\n    uniforms: customUniforms = {},\n    frag: customFrag,\n    fillValue,\n    mode = 'texture',\n    setLoading,\n    clearLoading,\n    invalidate,\n    invalidateRegion,\n    setMetadata,\n    order,\n    version = 'v2',\n    projection,\n  }) {\n    this.tiles = {}\n    this.loaders = {}\n    this.active = {}\n    this.display = display\n    this.clim = clim\n    this.opacity = opacity\n    this.selector = selector\n    this.variable = variable\n    this.fillValue = fillValue\n    this.order = order ?? [1, 1]\n    this.invalidate = invalidate\n    this.viewport = { viewportHeight: 0, viewportWidth: 0 }\n    this._loading = false\n    this.setLoading = setLoading\n    this.clearLoading = clearLoading\n\n    this.colormap = regl.texture({\n      data: colormap,\n      format: 'rgb',\n      shape: [colormap.length, 1],\n    })\n\n    const validModes = ['grid', 'dotgrid', 'texture']\n    if (!validModes.includes(mode)) {\n      throw Error(\n        `mode '${mode}' invalid, must be one of ${validModes.join(', ')}`\n      )\n    }\n\n    this.bands = getBands(variable, selector)\n\n    customUniforms = Object.keys(customUniforms)\n\n    let primitive,\n      initialize,\n      attributes = {},\n      uniforms = {}\n\n    if (mode === 'grid' || mode === 'dotgrid') {\n      primitive = 'points'\n      initialize = () => regl.buffer()\n      this.bands.forEach((k) => (attributes[k] = regl.prop(k)))\n      uniforms = {}\n    }\n\n    if (mode === 'texture') {\n      primitive = 'triangles'\n      this.bands.forEach((k) => (uniforms[k] = regl.prop(k)))\n    }\n\n    customUniforms.forEach((k) => (uniforms[k] = regl.this(k)))\n\n    this.cameraInitialized = new Promise((resolve) => {\n      let shouldResolve = true\n      this._resolveCameraInitialized = () => {\n        if (shouldResolve) {\n          resolve()\n          shouldResolve = false\n        }\n      }\n    })\n    this.initialized = new Promise((resolve) => {\n      const loadingID = this.setLoading('metadata')\n      initializeStore(source, version, variable, Object.keys(selector)).then(\n        ({\n          metadata,\n          loaders,\n          dimensions,\n          shape,\n          chunks,\n          fill_value,\n          dtype,\n          coordinates,\n          levels,\n          maxZoom,\n          tileSize,\n          crs,\n        }) => {\n          if (setMetadata) setMetadata(metadata)\n          this.maxZoom = maxZoom\n          this.level = zoomToLevel(this.zoom, maxZoom)\n          const position = getPositions(tileSize, mode)\n          this.position = regl.buffer(position)\n          this.size = tileSize\n          // Respect `projection` prop when provided, otherwise rely on `crs` value from metadata\n          this.projectionIndex = projection\n            ? ['mercator', 'equirectangular'].indexOf(projection)\n            : ['EPSG:3857', 'EPSG:4326'].indexOf(crs)\n          this.projection = ['mercator', 'equirectangular'][\n            this.projectionIndex\n          ]\n\n          if (!this.projection) {\n            this.projection = null\n            throw new Error(\n              projection\n                ? `Unexpected \\`projection\\` prop provided: '${projection}'. Must be one of 'mercator', 'equirectangular'.`\n                : `Unexpected \\`crs\\` found in metadata: '${crs}'. Must be one of 'EPSG:3857', 'EPSG:4326'.`\n            )\n          }\n\n          if (mode === 'grid' || mode === 'dotgrid') {\n            this.count = position.length\n          }\n          if (mode === 'texture') {\n            this.count = 6\n          }\n\n          this.dimensions = dimensions\n          this.shape = shape\n          this.chunks = chunks\n          this.fillValue = fillValue ?? fill_value ?? DEFAULT_FILL_VALUES[dtype]\n\n          if (mode === 'texture') {\n            const emptyTexture = ndarray(\n              new Float32Array(Array(1).fill(this.fillValue)),\n              [1, 1]\n            )\n            initialize = () => regl.texture(emptyTexture)\n          }\n\n          this.ndim = this.dimensions.length\n\n          this.coordinates = coordinates\n\n          levels.forEach((z) => {\n            const loader = loaders[z + '/' + variable]\n            this.loaders[z] = loader\n            Array(Math.pow(2, z))\n              .fill(0)\n              .map((_, x) => {\n                Array(Math.pow(2, z))\n                  .fill(0)\n                  .map((_, y) => {\n                    const key = [x, y, z].join(',')\n                    this.tiles[key] = new Tile({\n                      key,\n                      loader,\n                      shape: this.shape,\n                      chunks: this.chunks,\n                      dimensions: this.dimensions,\n                      coordinates: this.coordinates,\n                      bands: this.bands,\n                      initializeBuffer: initialize,\n                    })\n                  })\n              })\n          })\n\n          resolve(true)\n          this.clearLoading(loadingID)\n          this.invalidate()\n        }\n      )\n    })\n\n    this.drawTiles = regl({\n      vert: vert(mode, this.bands),\n\n      frag: frag(mode, this.bands, customFrag, customUniforms),\n\n      attributes: {\n        position: regl.this('position'),\n        ...attributes,\n      },\n\n      uniforms: {\n        viewportWidth: regl.context('viewportWidth'),\n        viewportHeight: regl.context('viewportHeight'),\n        pixelRatio: regl.context('pixelRatio'),\n        colormap: regl.this('colormap'),\n        camera: regl.this('camera'),\n        centerY: regl.this('centerY'),\n        size: regl.this('size'),\n        zoom: regl.this('zoom'),\n        projection: regl.this('projectionIndex'),\n        globalLevel: regl.this('level'),\n        level: regl.prop('level'),\n        offset: regl.prop('offset'),\n        order: regl.this('order'),\n        clim: regl.this('clim'),\n        opacity: regl.this('opacity'),\n        fillValue: regl.this('fillValue'),\n        ...uniforms,\n      },\n\n      blend: {\n        enable: true,\n        func: {\n          src: 'one',\n          srcAlpha: 'one',\n          dstRGB: 'one minus src alpha',\n          dstAlpha: 'one minus src alpha',\n        },\n      },\n\n      depth: { enable: false },\n\n      count: regl.this('count'),\n\n      primitive: primitive,\n    })\n\n    this.getProps = () => {\n      const adjustedActive = Object.keys(this.tiles)\n        .filter((key) => this.active[key])\n        .reduce((accum, key) => {\n          // Get optimum set of keys to render based on which have been fully loaded\n          // (potentially mixing levels of pyramid)\n          const keysToRender = getKeysToRender(key, this.tiles, this.maxZoom)\n          keysToRender.forEach((keyToRender) => {\n            const offsets = this.active[key]\n\n            offsets.forEach((offset) => {\n              const adjustedOffset = getAdjustedOffset(offset, keyToRender)\n              if (!accum[keyToRender]) {\n                accum[keyToRender] = []\n              }\n\n              const alreadySeenOffset = accum[keyToRender].find(\n                (prev) =>\n                  prev[0] === adjustedOffset[0] && prev[1] === adjustedOffset[1]\n              )\n              if (!alreadySeenOffset) {\n                accum[keyToRender].push(adjustedOffset)\n              }\n            })\n          })\n\n          return accum\n        }, {})\n\n      const activeKeys = Object.keys(adjustedActive)\n\n      return activeKeys.reduce((accum, key) => {\n        if (!getOverlappingAncestor(key, activeKeys)) {\n          const [, , level] = keyToTile(key)\n          const tile = this.tiles[key]\n          const offsets = adjustedActive[key]\n\n          offsets.forEach((offset) => {\n            accum.push({\n              ...tile.getBuffers(),\n              level,\n              offset,\n            })\n          })\n        }\n\n        return accum\n      }, [])\n    }\n\n    regl.frame(({ viewportHeight, viewportWidth }) => {\n      if (\n        this.viewport.viewportHeight !== viewportHeight ||\n        this.viewport.viewportWidth !== viewportWidth\n      ) {\n        this.viewport = { viewportHeight, viewportWidth }\n        this.invalidate()\n      }\n    })\n\n    this.draw = () => {\n      this.drawTiles(this.getProps())\n    }\n\n    this.updateCamera = ({ center, zoom }) => {\n      // Return early if projection not yet initialized\n      if (!this.projection) {\n        return\n      }\n\n      const level = zoomToLevel(zoom, this.maxZoom)\n      const tile = pointToTile(\n        center.lng,\n        center.lat,\n        level,\n        this.projection,\n        this.order\n      )\n      const camera = pointToCamera(center.lng, center.lat, level)\n\n      this.level = level\n      this.zoom = zoom\n      this.camera = [camera[0], camera[1]]\n      this.centerY = mercatorYFromLat(center.lat)\n\n      this.active = getSiblings(tile, {\n        viewport: this.viewport,\n        zoom,\n        camera: this.camera,\n        size: this.size,\n        order: this.order,\n        projection: this.projection,\n      })\n\n      this._resolveCameraInitialized()\n\n      if (this.size && Object.keys(this.active).length === 0) {\n        this.clearLoading(null, { forceClear: true })\n      }\n\n      Promise.all(\n        Object.keys(this.active).map(\n          (key) =>\n            new Promise((resolve) => {\n              if (this.loaders[level]) {\n                const tileIndex = keyToTile(key)\n                const tile = this.tiles[key]\n\n                const chunks = getChunks(\n                  this.selector,\n                  this.dimensions,\n                  this.coordinates,\n                  this.shape,\n                  this.chunks,\n                  tileIndex[0],\n                  tileIndex[1]\n                )\n                const initialHash = getSelectorHash(this.selector)\n\n                if (tile.hasPopulatedBuffer(this.selector)) {\n                  resolve(false)\n                  return\n                }\n\n                if (tile.isLoadingChunks(chunks)) {\n                  // If tile is already loading all chunks...\n                  tile.chunksLoaded(chunks).then(() => {\n                    // ...wait for ready state and populate buffers if selector is still relevant.\n                    if (initialHash === getSelectorHash(this.selector)) {\n                      tile.populateBuffersSync(this.selector)\n                      this.invalidate()\n                      resolve(false)\n                    } else {\n                      resolve(false)\n                    }\n                  })\n                } else {\n                  // Otherwise, immediately kick off fetch or populate buffers.\n                  if (tile.hasLoadedChunks(chunks)) {\n                    tile.populateBuffersSync(this.selector)\n                    this.invalidate()\n                    resolve(false)\n                  } else {\n                    const loadingID = this.setLoading('chunk')\n                    tile\n                      .populateBuffers(chunks, this.selector)\n                      .then((dataUpdated) => {\n                        this.invalidate()\n                        resolve(dataUpdated)\n                        this.clearLoading(loadingID)\n                      })\n                  }\n                }\n              }\n            })\n        )\n      ).then((results) => {\n        if (results.some(Boolean)) {\n          invalidateRegion()\n        }\n      })\n    }\n\n    this.queryRegion = async (region, selector) => {\n      await Promise.all([this.initialized, this.cameraInitialized])\n\n      const tiles = getTilesOfRegion(\n        region,\n        this.level,\n        this.projection,\n        this.order\n      )\n\n      await Promise.all(\n        tiles.map(async (key) => {\n          const tileIndex = keyToTile(key)\n          const chunks = getChunks(\n            selector,\n            this.dimensions,\n            this.coordinates,\n            this.shape,\n            this.chunks,\n            tileIndex[0],\n            tileIndex[1]\n          )\n\n          if (!this.tiles[key].hasLoadedChunks(chunks)) {\n            const loadingID = this.setLoading('chunk')\n            await this.tiles[key].loadChunks(chunks)\n            this.clearLoading(loadingID)\n          }\n        })\n      )\n\n      let results,\n        lat = [],\n        lon = []\n      const resultDim =\n        this.ndim -\n        Object.keys(selector).filter((k) => !Array.isArray(selector[k])).length\n      if (resultDim > 2) {\n        results = {}\n      } else {\n        results = []\n      }\n\n      tiles.map((key) => {\n        const [x, y, z] = keyToTile(key)\n        const z2 = Math.pow(2, z)\n        const sizeDeg = 180 / z2\n        const stepDeg = sizeDeg / this.size\n\n        const lat0 = this.order[1] * (90 - y * sizeDeg)\n\n        const { center, radius, units } = region.properties\n        for (let i = 0; i < this.size; i++) {\n          for (let j = 0; j < this.size; j++) {\n            const [mercLon, mercLat] = cameraToPoint(\n              x + i / this.size,\n              y + j / this.size,\n              z\n            )\n            const pointCoords = [\n              mercLon,\n              this.projection === 'equirectangular'\n                ? lat0 - this.order[1] * stepDeg * j\n                : mercLat,\n            ]\n            const distanceToCenter = distance(\n              [center.lng, center.lat],\n              pointCoords,\n              {\n                units,\n              }\n            )\n            if (distanceToCenter < radius) {\n              lon.push(pointCoords[0])\n              lat.push(pointCoords[1])\n\n              const valuesToSet = this.tiles[key].getPointValues({\n                selector,\n                point: [i, j],\n              })\n\n              valuesToSet.forEach(({ keys, value }) => {\n                if (keys.length > 0) {\n                  setObjectValues(results, keys, value)\n                } else {\n                  results.push(value)\n                }\n              })\n            }\n          }\n        }\n      })\n\n      const out = { [this.variable]: results }\n\n      if (this.ndim > 2) {\n        out.dimensions = this.dimensions.map((d) => {\n          if (['x', 'lon'].includes(d)) {\n            return 'lon'\n          } else if (['y', 'lat'].includes(d)) {\n            return 'lat'\n          } else {\n            return d\n          }\n        })\n\n        out.coordinates = this.dimensions.reduce(\n          (coords, d) => {\n            if (!['x', 'lon', 'y', 'lat'].includes(d)) {\n              if (selector.hasOwnProperty(d)) {\n                coords[d] = Array.isArray(selector[d])\n                  ? selector[d]\n                  : [selector[d]]\n              } else {\n                coords[d] = this.coordinates[d]\n              }\n            }\n\n            return coords\n          },\n          { lat, lon }\n        )\n      } else {\n        out.dimensions = ['lat', 'lon']\n        out.coordinates = { lat, lon }\n      }\n\n      return out\n    }\n\n    this.updateSelector = ({ selector }) => {\n      this.selector = selector\n      this.invalidate()\n    }\n\n    this.updateUniforms = (props) => {\n      Object.keys(props).forEach((k) => {\n        this[k] = props[k]\n      })\n      if (!this.display) {\n        this.opacity = 0\n      }\n      this.invalidate()\n    }\n\n    this.updateColormap = ({ colormap }) => {\n      this.colormap = regl.texture({\n        data: colormap,\n        format: 'rgb',\n        shape: [colormap.length, 1],\n      })\n      this.invalidate()\n    }\n  }\n}\n","import React, { useRef, useEffect, useState } from 'react'\nimport { useRegl } from './regl'\nimport { useMapbox } from './mapbox'\nimport { useControls } from './use-controls'\nimport { createTiles } from './tiles'\nimport { useRegion } from './region/context'\nimport { useSetLoading } from './loading'\n\nconst Raster = (props) => {\n  const {\n    display = true,\n    opacity = 1,\n    clim,\n    colormap,\n    index = 0,\n    regionOptions = {},\n    selector = {},\n    uniforms = {},\n  } = props\n  const { center, zoom } = useControls()\n  const [regionDataInvalidated, setRegionDataInvalidated] = useState(\n    new Date().getTime()\n  )\n  const { regl } = useRegl()\n  const { map } = useMapbox()\n  const { region } = useRegion()\n  const { setLoading, clearLoading, loading, chunkLoading, metadataLoading } =\n    useSetLoading()\n  const tiles = useRef()\n  const camera = useRef()\n  const lastQueried = useRef()\n\n  camera.current = { center: center, zoom: zoom }\n\n  const queryRegion = async (r, s) => {\n    const queryStart = new Date().getTime()\n    lastQueried.current = queryStart\n\n    regionOptions.setData({ value: null })\n\n    const data = await tiles.current.queryRegion(r, s)\n\n    // Invoke callback as long as a more recent query has not already been initiated\n    if (lastQueried.current === queryStart) {\n      regionOptions.setData({ value: data })\n    }\n  }\n\n  useEffect(() => {\n    tiles.current = createTiles(regl, {\n      ...props,\n      setLoading,\n      clearLoading,\n      invalidate: () => {\n        map.triggerRepaint()\n      },\n      invalidateRegion: () => {\n        setRegionDataInvalidated(new Date().getTime())\n      },\n    })\n  }, [])\n\n  useEffect(() => {\n    if (props.setLoading) {\n      props.setLoading(loading)\n    }\n  }, [!!props.setLoading, loading])\n  useEffect(() => {\n    if (props.setMetadataLoading) {\n      props.setMetadataLoading(metadataLoading)\n    }\n  }, [!!props.setMetadataLoading, metadataLoading])\n  useEffect(() => {\n    if (props.setChunkLoading) {\n      props.setChunkLoading(chunkLoading)\n    }\n  }, [!!props.setChunkLoading, chunkLoading])\n\n  useEffect(() => {\n    const callback = () => {\n      if (Object.values(camera.current).some(Boolean)) {\n        tiles.current.updateCamera(camera.current)\n        tiles.current.draw()\n      }\n    }\n    map.on('render', callback)\n\n    return () => {\n      regl.clear({\n        color: [0, 0, 0, 0],\n        depth: 1,\n      })\n      map.off('render', callback)\n      map.triggerRepaint()\n    }\n  }, [index])\n\n  useEffect(() => {\n    tiles.current.updateSelector({ selector })\n  }, Object.values(selector))\n\n  useEffect(() => {\n    tiles.current.updateUniforms({ display, opacity, clim, ...uniforms })\n  }, [display, opacity, clim, ...Object.values(uniforms)])\n\n  useEffect(() => {\n    tiles.current.updateColormap({ colormap })\n  }, [colormap])\n\n  useEffect(() => {\n    if (region && regionOptions?.setData) {\n      queryRegion(region, regionOptions.selector || selector)\n    }\n  }, [\n    regionOptions?.setData,\n    region,\n    regionDataInvalidated,\n    ...Object.values(regionOptions?.selector || selector || {}),\n  ])\n\n  return null\n}\n\nexport default Raster\n","import { useEffect, useRef } from 'react'\nimport { useMapbox } from './mapbox'\nimport { updatePaintProperty } from './utils'\nimport { v4 as uuidv4 } from 'uuid'\n\nconst Line = ({\n  source,\n  variable,\n  color,\n  id,\n  maxZoom = 5,\n  opacity = 1,\n  blur = 0.4,\n  width = 0.5,\n}) => {\n  const { map } = useMapbox()\n  const removed = useRef(false)\n\n  const sourceIdRef = useRef()\n  const layerIdRef = useRef()\n\n  useEffect(() => {\n    map.on('remove', () => {\n      removed.current = true\n    })\n  }, [])\n\n  useEffect(() => {\n    sourceIdRef.current = id || uuidv4()\n    const { current: sourceId } = sourceIdRef\n    if (!map.getSource(sourceId)) {\n      map.addSource(sourceId, {\n        type: 'vector',\n        tiles: [`${source}/{z}/{x}/{y}.pbf`],\n      })\n      if (maxZoom) {\n        map.getSource(sourceId).maxzoom = maxZoom\n      }\n    }\n  }, [id])\n\n  useEffect(() => {\n    const layerId = layerIdRef.current || uuidv4()\n    layerIdRef.current = layerId\n    const { current: sourceId } = sourceIdRef\n    if (!map.getLayer(layerId)) {\n      map.addLayer({\n        id: layerId,\n        type: 'line',\n        source: sourceId,\n        'source-layer': variable,\n        layout: { visibility: 'visible' },\n        paint: {\n          'line-blur': blur,\n          'line-color': color,\n          'line-opacity': opacity,\n          'line-width': width,\n        },\n      })\n    }\n\n    return () => {\n      if (!removed.current) {\n        if (map.getLayer(layerId)) {\n          map.removeLayer(layerId)\n        }\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'line-color', color)\n  }, [color])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'line-opacity', opacity)\n  }, [opacity])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'line-width', width)\n  }, [width])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'line-blur', blur)\n  }, [blur])\n\n  return null\n}\n\nexport default Line\n","import { useEffect, useRef } from 'react'\nimport { useMapbox } from './mapbox'\nimport { updatePaintProperty } from './utils'\nimport { v4 as uuidv4 } from 'uuid'\n\nconst Fill = ({ source, variable, color, id, maxZoom = 5, opacity = 1 }) => {\n  const { map } = useMapbox()\n  const removed = useRef(false)\n\n  const sourceIdRef = useRef()\n  const layerIdRef = useRef()\n\n  useEffect(() => {\n    map.on('remove', () => {\n      removed.current = true\n    })\n  }, [])\n\n  useEffect(() => {\n    sourceIdRef.current = id || uuidv4()\n    const { current: sourceId } = sourceIdRef\n    if (!map.getSource(sourceId)) {\n      map.addSource(sourceId, {\n        type: 'vector',\n        tiles: [`${source}/{z}/{x}/{y}.pbf`],\n      })\n      if (maxZoom) {\n        map.getSource(sourceId).maxzoom = maxZoom\n      }\n    }\n  }, [id])\n\n  useEffect(() => {\n    layerIdRef.current = uuidv4()\n    const { current: layerId } = layerIdRef\n    const { current: sourceId } = sourceIdRef\n    if (!map.getLayer(layerId)) {\n      map.addLayer({\n        id: layerId,\n        type: 'fill',\n        source: sourceId,\n        'source-layer': variable,\n        layout: { visibility: 'visible' },\n        paint: {\n          'fill-color': color,\n          'fill-opacity': opacity,\n        },\n      })\n    }\n\n    return () => {\n      if (!removed.current) {\n        if (map.getLayer(layerId)) {\n          map.removeLayer(layerId)\n        }\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'fill-color', color)\n  }, [color])\n\n  useEffect(() => {\n    updatePaintProperty(map, layerIdRef, 'fill-opacity', opacity)\n  }, [opacity])\n\n  return null\n}\n\nexport default Fill\n","import { useEffect } from 'react'\nimport { ticks } from 'd3-array'\nimport { axisBottom, axisLeft } from 'd3-axis'\nimport { scaleOrdinal } from 'd3-scale'\nimport { select } from 'd3-selection'\n\nimport { useMapbox } from './mapbox'\n\nconst TICK_SEPARATION = 150 // target distance between ticks\nconst TICK_SIZE = 6 // tick length\nconst TICK_MARGIN = 2 // distance between gridlines and tick text\n\nfunction useRuler({\n  showAxes = true,\n  showGrid = false,\n  fontFamily,\n  gridColor,\n}) {\n  const { map } = useMapbox()\n\n  useEffect(() => {\n    if (!showAxes && !showGrid) {\n      return\n    }\n\n    let rulerContainer = null\n    let setRulerTicks = null\n\n    function addRuler() {\n      const mapContainer = map.getContainer()\n      const height = mapContainer.offsetHeight\n      const width = mapContainer.offsetWidth\n      const numXTicks = width / TICK_SEPARATION\n      const numYTicks = height / TICK_SEPARATION\n\n      rulerContainer = select(mapContainer)\n        .append('svg')\n        .classed('ruler', true)\n        .attr('width', width)\n        .attr('height', height)\n        .style('position', 'absolute')\n        .style('top', 0)\n        .style('left', 0)\n        .style('pointer-events', 'none')\n\n      // x-axis\n      const gx = rulerContainer\n        .append('g')\n        .classed('ruler-axis', true)\n        .style('font-size', '14px')\n        .style('font-family', fontFamily)\n\n      const xAxis = (g, x) =>\n        g\n          .call(\n            axisBottom(x)\n              .tickValues(x.domain())\n              .tickFormat((d) => `${d}°`)\n              .tickSize(TICK_SIZE)\n          )\n          .call((g) => g.select('.domain').remove())\n\n      // y-axis\n      const gy = rulerContainer\n        .append('g')\n        .classed('ruler-axis', true)\n        .attr('transform', `translate(${width},0)`)\n        .style('font-size', '14px')\n        .style('font-family', fontFamily)\n\n      const yAxis = (g, y) =>\n        g\n          .call(\n            axisLeft(y)\n              .tickValues(y.domain())\n              .tickFormat((d) => `${d}°`)\n              .tickSize(TICK_SIZE)\n          )\n          .call((g) => g.select('.domain').remove())\n\n      // grid\n      const { gGrid, grid } = showGrid\n        ? {\n            gGrid: rulerContainer\n              .append('g')\n              .classed('ruler-grid', true)\n              .style('stroke', gridColor)\n              .style('stroke-dasharray', '3,2')\n              .style('stroke-opacity', 0.8),\n\n            grid: (g, x, y) => {\n              const xTickHeight = gx.node().getBoundingClientRect().height\n              const yTickNodes = gy.selectAll('.tick').nodes()\n              return g\n                .call((g) =>\n                  g\n                    .selectAll('.x')\n                    .data(x.domain())\n                    .join(\n                      (enter) =>\n                        enter\n                          .append('line')\n                          .classed('x', true)\n                          .attr('y1', xTickHeight + TICK_MARGIN)\n                          .attr('y2', height),\n                      (update) => update,\n                      (exit) => exit.remove()\n                    )\n                    .attr('x1', (d) => 0.5 + x(d))\n                    .attr('x2', (d) => 0.5 + x(d))\n                )\n                .call((g) =>\n                  g\n                    .selectAll('.y')\n                    .data(y.domain())\n                    .join(\n                      (enter) => enter.append('line').classed('y', true),\n                      (update) => update,\n                      (exit) => exit.remove()\n                    )\n                    .attr('y1', (d) => 0.5 + y(d))\n                    .attr('y2', (d) => 0.5 + y(d))\n                    .attr('x2', (d, i) => {\n                      const yTickWidth = yTickNodes[i]\n                        ? yTickNodes[i].getBoundingClientRect().width\n                        : 0\n                      return width - yTickWidth - TICK_MARGIN\n                    })\n                )\n            },\n          }\n        : {\n            gGrid: null,\n            grid: null,\n          }\n\n      // the important bit\n      setRulerTicks = () => {\n        const b = map.getBounds()\n\n        const xDomain = ticks(b.getWest(), b.getEast(), numXTicks)\n        const xRange = xDomain.map((lng) => map.project([lng, 0]).x)\n        const x = scaleOrdinal().domain(xDomain).range(xRange)\n\n        const yDomain = ticks(b.getNorth(), b.getSouth(), numYTicks)\n        const yRange = yDomain.map((lat) => map.project([0, lat]).y)\n        const y = scaleOrdinal().domain(yDomain).range(yRange)\n\n        if (showAxes) {\n          gx.call(xAxis, x)\n          gy.call(yAxis, y)\n        }\n        if (showGrid) {\n          gGrid.call(grid, x, y)\n        }\n      }\n\n      setRulerTicks()\n      map.on('move', setRulerTicks)\n    }\n\n    function removeRuler() {\n      if (rulerContainer) {\n        rulerContainer.remove()\n      }\n      if (setRulerTicks) {\n        map.off('move', setRulerTicks)\n      }\n    }\n\n    function resetRuler() {\n      removeRuler()\n      addRuler()\n    }\n\n    addRuler()\n    map.on('resize', resetRuler)\n\n    return function cleanup() {\n      removeRuler()\n      map.off('resize', resetRuler)\n    }\n  }, [showAxes, showGrid, fontFamily, gridColor])\n}\n\nexport default useRuler\n"],"names":["MapboxContext","createContext","useMapbox","useContext","Mapbox","glyphs","style","viewState","center","zoom","minZoom","maxZoom","maxBounds","debug","children","mapRef","onMove","onMoveStart","onMoveEnd","onViewStateChange","map","useRef","ready","setReady","useState","onViewStateChangeHandlerRef","initializeMap","useCallback","node","current","mapboxStyle","version","sources","layers","console","error","longitude","latitude","bearing","pitch","mapboxgl","Map","container","dragRotate","pitchWithRotate","touchZoomRotate","disableRotation","touchPitch","disable","showTileBoundaries","on","log","handler","lng","lat","getCenter","getZoom","getBearing","getPitch","useEffect","jumpTo","off","remove","top","bottom","position","width","GL_DEPTH_COMPONENT","GL_DEPTH_STENCIL","HALF_FLOAT_OES","gl2Extensions","WEBGL_depth_texture","UNSIGNED_INT_24_8_WEBGL","OES_element_index_uint","OES_texture_float","OES_texture_half_float","EXT_color_buffer_float","OES_standard_derivatives","EXT_frag_depth","EXT_blend_minmax","MIN_EXT","MAX_EXT","EXT_shader_texture_lod","extensions","webgl2Compat","overrideContextType","callback","webgl2","origGetContext","HTMLCanvasElement","prototype","getContext","ignoredContextType","contextAttributes","wrapGLContext","bind","rv","gl","versionProperty","p","toLowerCase","getExtension","origGetExtension","n","apply","origTexImage","texImage2D","target","miplevel","iformat","a","typeFor6","c","d","typeFor9","f","getInternalFormat","getFormat","getTextureType","arguments","length","ifmt","fmt","call","type","ArrayBuffer","isView","typedArray","FLOAT","Float32Array","UNSIGNED_BYTE","Uint8Array","UNSIGNED_SHORT","Uint16Array","Error","drawBuffersWEBGL","drawBuffers","VERTEX_ARRAY_BINDING_OES","createVertexArrayOES","createVertexArray","deleteVertexArrayOES","deleteVertexArray","isVertexArrayOES","isVertexArray","bindVertexArrayOES","bindVertexArray","VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE","drawArraysInstancedANGLE","drawArraysInstanced","drawElementsInstancedANGLE","drawElementsInstanced","vertexAttribDivisorANGLE","vertexAttribDivisor","format","DEPTH_COMPONENT24","DEPTH24_STENCIL8","RGBA","RGBA16F","RGB","RGB16F","RGBA32F","RGB32F","LUMINANCE","R32F","R8","HALF_FLOAT","RED","ReglContext","useRegl","Regl","reglRef","ref","requiredExtensions","canvas","document","createElement","context","missingExtensions","filter","ext","_regl","err","destroy","regl","height","RegionContext","region","onChange","useRegionContext","useRegion","RegionProvider","setRegion","LoadingContext","useSetLoading","loadingId","uuidv4","loading","dispatch","metadataIds","setMetadataIds","Set","chunkIds","setChunkIds","loaders","id","key","forEach","push","size","setLoading","includes","setter","prev","add","clearLoading","forceClear","prevMetadata","delete","prevChunk","metadataLoading","chunkLoading","reducer","state","action","LoadingProvider","useReducer","metadata","chunk","useLoadingContext","LoadingUpdater","setMetadataLoading","setChunkLoading","tabIndex","className","overflow","pointerEvents","zIndex","project","coordinates","options","ll","LngLat","convert","result","referencePoint","deltas","delta","alternate","Math","abs","x","getPathMaker","transform","geoTransform","point","stream","y","geoPath","projection","CursorManager","getCanvas","originalStyle","cursor","mouseState","onHandle","draggingHandle","onCircle","draggingCircle","setCursor","newState","POLES","abbreviations","kilometers","miles","CircleRenderer","onIdle","circle","onDrag","initialCenter","initialRadius","maxRadius","minRadius","units","centerXY","radius","svg","select","svgCircle","svgCircleCutout","svgHandle","svgGuideline","svgRadiusTextContainer","svgRadiusText","attr","guidelineAngle","removers","addDragHandleListeners","onMouseMove","e","r","distance","unproject","toArray","min","max","setRadius","mouseXY","rise","run","angle","atan","PI","setCircle","onMouseUp","handleStart","dragPan","once","removeDragHandleListeners","addCircleListeners","offset","mapCanvas","setCenter","lngLat","enable","handleCircleStart","touch","touches","pageX","pageY","offsetX","offsetY","preventDefault","newEvent","constructor","dispatchEvent","removeCircleListeners","addMapMoveListeners","removeMapMoveListeners","geoCircle","inverted","turfCircle","steps","properties","area","convertArea","rewind","reverse","mutate","_center","_point","nearPoles","resetCenterXY","_radius","turfPoint","some","pole","makePath","path","cutoutCircle","cutoutPath","getBBox","handleXY","rhumbDestination","geometry","lineEnd","line","lineString","inter","lineIntersect","features","translateY","text","toFixed","translateX","textWidth","coeff","sin","CirclePicker","backgroundColor","color","fontFamily","fontSize","renderer","setRenderer","cleanup","loaded","left","getInitialRadius","bounds","getBounds","dist","round","isValidCoordinate","isNaN","getInitialCenter","Array","isArray","warn","RegionPicker","initialRadiusProp","initialCenterProp","handleCircle","undefined","useRecenterRegion","value","setValue","recenterRegion","easeTo","useControls","setZoom","updateControlsSync","flushSync","_sh","mode","which","vert","vars","sh","join","frag","customFrag","customUniforms","declarations","mercatorInvert","d2r","clip","v","keyToTile","split","parseInt","tileToKey","tile","pointToTile","lon","z","order","z2","pow","pointToCamera","floor","cameraToPoint","y2","exp","zoomToLevel","mercatorYFromLat","tan","getOffsets","tileSize","cameraOffset","siblingCount","next","ceil","getTileOffsets","camera","getLatBasedOffsets","sizeDeg","lat0","lat1","y0","y1","magnification","scale","window","devicePixelRatio","getSiblings","viewport","tileX","tileY","tileZ","viewportHeight","viewportWidth","cameraX","cameraY","deltaX","deltaY","offsets","reduce","accum","getKeysToRender","targetKey","tiles","ancestor","getAncestorToRender","descendants","getDescendantsToRender","isBufferPopulated","initialX","initialY","initialZ","coverage","keys","coveringKeys","currentCoverage","getOverlappingAncestor","renderedKeys","aX","aY","aZ","child","find","parentKey","bX","bY","bZ","parent","factor","getAdjustedOffset","renderedKey","renderedX","renderedY","renderedLevel","level","descendantFactor","getTilesOfRegion","centralTile","edgeTile","maxDiff","centerPoint","rhumbBearing","i","intermediatePoint","intermediateTile","from","getPyramidMetadata","multiscales","datasets","levels","dataset","Number","pixels_per_tile","crs","getBandInformation","selector","combinedBands","Object","bandMapping","selectorKey","values","bands","updatedBands","band","bandKey","combinedKey","getBands","variable","bandInfo","bandNames","setObjectValues","obj","getSelectorHash","JSON","stringify","getChunks","dimensions","shape","chunks","chunkIndicesToUse","dimension","selectorValue","coords","chunkSize","indices","indexOf","fill","_","j","index","updatedResult","getPositions","updatePaintProperty","getLayer","setPaintProperty","DEFAULT_FILL_VALUES","Tile","loader","initializeBuffer","tileCoordinates","_bufferCache","_buffers","_loading","_ready","k","chunkedData","_loader","getBuffers","loadChunks","updated","Promise","all","resolve","innerResolve","data","Boolean","populateBuffers","populateBuffersSync","bandInformation","info","chunkKey","bandData","findIndex","coordinate","pick","isLoading","isLoadingChunks","every","chunksLoaded","hasLoadedChunks","hasPopulatedBuffer","getPointValues","chunkData","combinedIndices","count","chunkOffset","hasOwnProperty","selectorValues","selectorIndices","concat","updatedAccum","el","chunkIndices","get","initializeStore","source","coordinateKeys","fill_value","dtype","zarr","fetch","openGroup","l","m","zattrs","zarray","then","res","json","attributes","arrayMetadata","isSharded","codecs","name","configuration","chunk_shape","chunk_grid","open","createTiles","opts","Tiles","colormap","clim","opacity","display","uniforms","fillValue","invalidate","invalidateRegion","setMetadata","active","texture","validModes","primitive","initialize","buffer","prop","this","cameraInitialized","shouldResolve","_resolveCameraInitialized","initialized","loadingID","projectionIndex","emptyTexture","ndarray","ndim","drawTiles","pixelRatio","centerY","globalLevel","blend","func","src","srcAlpha","dstRGB","dstAlpha","depth","getProps","adjustedActive","keysToRender","keyToRender","adjustedOffset","alreadySeenOffset","activeKeys","frame","draw","updateCamera","tileIndex","initialHash","dataUpdated","results","queryRegion","resultDim","stepDeg","mercLon","mercLat","pointCoords","distanceToCenter","valuesToSet","out","updateSelector","updateUniforms","props","updateColormap","Raster","regionOptions","regionDataInvalidated","setRegionDataInvalidated","Date","getTime","lastQueried","s","queryStart","setData","triggerRepaint","clear","Line","blur","removed","sourceIdRef","layerIdRef","sourceId","getSource","addSource","maxzoom","layerId","addLayer","layout","visibility","paint","removeLayer","Fill","TICK_SEPARATION","TICK_SIZE","TICK_MARGIN","useRuler","showAxes","showGrid","gridColor","rulerContainer","setRulerTicks","addRuler","mapContainer","getContainer","offsetHeight","offsetWidth","numXTicks","numYTicks","append","classed","gx","xAxis","g","axisBottom","tickValues","domain","tickFormat","tickSize","gy","yAxis","axisLeft","gGrid","grid","xTickHeight","getBoundingClientRect","yTickNodes","selectAll","nodes","enter","update","exit","yTickWidth","b","xDomain","ticks","getWest","getEast","xRange","scaleOrdinal","range","yDomain","getNorth","getSouth","yRange","removeRuler","resetRuler"],"mappings":"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"}